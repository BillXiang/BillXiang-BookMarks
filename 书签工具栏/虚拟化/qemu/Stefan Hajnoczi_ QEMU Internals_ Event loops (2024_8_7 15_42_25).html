<!DOCTYPE html> <html class=v2 dir=ltr xmlns=http://www.w3.org/1999/xhtml xmlns:b=http://www.google.com/2005/gml/b xmlns:data=http://www.google.com/2005/gml/data xmlns:expr=http://www.google.com/2005/gml/expr style><!--
 Page saved with SingleFile 
 url: http://blog.vmsplice.net/2020/08/qemu-internals-event-loops.html 
 saved date: Wed Aug 07 2024 15:42:25 GMT+0800 (中国标准时间)
--><meta charset=utf-8>
<style>html{height:100%}body{min-height:100%;position:relative}.content{position:relative;word-wrap:break-word}.content-outer,.region-inner{min-height:0;margin:0 auto}.columns{zoom:1}.columns-inner{min-height:0}.column-center-outer,.column-left-outer,.column-right-outer{position:relative;float:left}.column-center-outer{width:100%}.fauxcolumns{position:relative}.fauxcolumn-outer{position:absolute;top:0;bottom:0;overflow:hidden}.fauxcolumn-outer .fauxborder-left,.fauxcolumn-outer .fauxborder-right,.fauxcolumn-inner{height:100%}.fauxcolumn-left-outer{left:0}.fauxcolumn-right-outer{right:0}.cap-top,.cap-bottom{position:relative;height:0;background-repeat:repeat-x}.cap-top .cap-left,.cap-top .cap-right,.cap-bottom .cap-left,.cap-bottom .cap-right{height:100%;background-repeat:no-repeat}.cap-top,.cap-top .cap-left{background-position:top left}.cap-bottom,.cap-bottom .cap-left{background-position:bottom left}.cap-top .cap-left,.cap-bottom .cap-left{float:left}.cap-top .cap-right{background-position:top right;float:right}.cap-bottom .cap-right{background-position:bottom right;float:right}.fauxborder-left{background-position:top left;background-repeat:repeat-y;position:relative}.fauxborder-right{background-position:top right;background-repeat:repeat-y;position:absolute;right:0;height:100%}.body-fauxcolumns,.content-fauxcolumns{position:absolute;top:0;left:0;z-index:-1;height:100%;width:100%;overflow:hidden}.body-fauxcolumns .fauxcolumn-outer{width:100%}.content-fauxcolumns .fauxcolumn-outer{position:relative;overflow:visible;height:100%;margin:0 auto}body{margin:0}.content-outer,.header-outer,.tabs-outer,.main-outer,.main-inner,.footer-outer,.post,.comments,.widget,.date-header{position:relative;min-height:0}.footer-outer{margin-bottom:-1px}.tabs-inner{padding:0 15px}.main-inner{padding:30px 0}.main-inner .column-left-inner,.main-inner .column-right-inner{padding:0 15px}.footer-inner{padding:30px 15px}.section{margin:0 15px}.widget{margin:30px 0}.section:first-child .widget:first-child{margin-top:0}.section:last-child .widget:last-child{margin-bottom:0}body .navbar{height:30px;padding:0;margin:0}body .navbar .Navbar{position:absolute;z-index:10;left:0;width:100%;margin:0;padding:0;background:none;border:none}.header-inner .section{margin:0}.header-inner .widget{margin-left:30px;margin-right:30px}.header-inner .Header{margin:0}.header-inner .Header #header-inner{overflow:hidden}.header-inner .Header .descriptionwrapper{margin-bottom:25px}.Header h1{margin-bottom:10px}.Header .description{margin:.5em 0 10px;padding:0 2px}h1,h2,h3{margin:0;position:relative}h1 a:hover{text-decoration:none}.widget{line-height:1.4}.widget ul{padding:0 0 0 1.25em;margin:0;line-height:1.2}.widget li{padding:.25em 0;margin:0;text-indent:0}.widget .post-body ul{padding:0 2.5em;margin:.5em 0;line-height:1.4}.widget .post-body li{margin-bottom:.25em;padding-top:0;padding-bottom:0}.post-body{width:100%}.post-footer-line>*{margin-right:1em}.post-footer-line>*:last-child{margin-right:0}.post-timestamp{margin-left:-1em}.post-footer-line>*:first-child{margin-left:0}aside,header,footer{display:block}div.clear{clear:both}#navbar-iframe{display:block;height:30px}body{overflow-wrap:break-word;word-break:break-word;word-wrap:break-word}.post-share-buttons{position:relative}#ArchiveList .toggle{cursor:pointer;font-family:Arial,sans-serif}#ArchiveList .toggle-open{line-height:.6em}#ArchiveList{text-align:left}#ArchiveList a.post-count-link,#ArchiveList a.post-count-link:link,#ArchiveList a.post-count-link:visited{text-decoration:none}#ArchiveList a.toggle,#ArchiveList a.toggle:link,#ArchiveList a.toggle:visited,#ArchiveList a.toggle:hover{color:inherit;text-decoration:none}.BlogArchive #ArchiveList ul li{background:none;list-style:none;list-style-image:none;list-style-position:outside;border-width:0;padding-left:15px;text-indent:-15px;margin:.25em 0;background-image:none}.BlogArchive #ArchiveList ul ul li{padding-left:1.2em}.BlogArchive #ArchiveList ul{margin:0;padding:0;list-style:none;list-style-image:none;border-width:0}.BlogArchive #ArchiveList ul.posts li{padding-left:1.3em}.post-footer abbr{border:none}#blog-pager-newer-link{float:left}#blog-pager-older-link{float:right}#blog-pager{margin:1em 0;text-align:center;overflow:hidden}.comments{clear:both;margin-top:10px;margin-bottom:0}@media screen and (max-device-width:480px){}@media all{}.post-share-buttons{display:inline-block;margin-top:.5em;vertical-align:middle}.share-button{width:20px;height:20px;background:/* original URL: https://www.blogger.com/img/share_buttons_20_3.png */url(data:image/png;base64,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)no-repeat left!important;overflow:hidden;margin-left:-1px}a:hover.share-button{text-decoration:none;z-index:1}.share-button-link-text{display:block;text-indent:-9999px}.sb-email{background-position:0 0!important}a:hover.sb-email{background-position:0-20px!important}a:active.sb-email{background-position:0-40px!important}.sb-blog{background-position:-20px 0!important}a:hover.sb-blog{background-position:-20px -20px!important}a:active.sb-blog{background-position:-20px -40px!important}.sb-twitter{background-position:-40px 0!important}a:hover.sb-twitter{background-position:-40px -20px!important}a:active.sb-twitter{background-position:-40px -40px!important}.sb-facebook{background-position:-60px 0!important}a:hover.sb-facebook{background-position:-60px -20px!important}a:active.sb-facebook{background-position:-60px -40px!important}.sb-pinterest{background-position:-100px 0!important}a:hover.sb-pinterest{background-position:-100px -20px!important}a:active.sb-pinterest{background-position:-100px -40px!important}.goog-inline-block{position:relative;display:-moz-inline-box;display:inline-block}</style>
<meta content="IE=EmulateIE7" http-equiv=X-UA-Compatible>
<meta content="width=1100" name=viewport>
<meta content=blogger name=generator>
<link href=http://blog.vmsplice.net/2020/08/qemu-internals-event-loops.html rel=canonical>
<link rel=alternate type=application/atom+xml title="Stefan Hajnoczi - Atom" href=http://blog.vmsplice.net/feeds/posts/default>
<link rel=alternate type=application/rss+xml title="Stefan Hajnoczi - RSS" href="http://blog.vmsplice.net/feeds/posts/default?alt=rss">
<link rel=service.post type=application/atom+xml title="Stefan Hajnoczi - Atom" href=https://www.blogger.com/feeds/4281281032294244120/posts/default>
<link rel=alternate type=application/atom+xml title="Stefan Hajnoczi - Atom" href=http://blog.vmsplice.net/feeds/8542421998121464974/comments/default>
<meta content=http://blog.vmsplice.net/2020/08/qemu-internals-event-loops.html property=og:url>
<meta content="QEMU Internals: Event loops" property=og:title>
<meta content="This post explains event loops in QEMU v5.1.0 and their unique features         compared to other event loop implementations. The APIs are n..." property=og:description>
<title>Stefan Hajnoczi: QEMU Internals: Event loops</title>
<style id=page-skin-1><!--body{font:normal normal 14pt Arial,Tahoma,Helvetica,FreeSans,sans-serif;color:#cccccc;background:#292929 none repeat scroll top left;padding:0 40px 40px 40px}html body .region-inner{min-width:0;max-width:100%;width:auto}h2{font-size:22px}a:link{text-decoration:none;color:#dd7700}a:visited{text-decoration:none;color:#cc6600}a:hover{text-decoration:underline;color:#cc6600}.body-fauxcolumn-outer .fauxcolumn-inner{background:transparent none repeat scroll top left}.body-fauxcolumn-outer .cap-top{position:absolute;z-index:1;height:400px;width:100%}.body-fauxcolumn-outer .cap-top .cap-left{width:100%;background:transparent none repeat-x scroll top left}.content-outer{-moz-box-shadow:0 0 40px rgba(0,0,0,.15);-webkit-box-shadow:0 0 5px rgba(0,0,0,.15);-goog-ms-box-shadow:0 0 10px #333333;box-shadow:0 0 40px rgba(0,0,0,.15);margin-bottom:1px}.content-inner{padding:10px 10px}.content-inner{background-color:#333333}.header-outer{background:transparent none repeat-x scroll 0-400px}.Header h1{font:normal normal 60px Arial,Tahoma,Helvetica,FreeSans,sans-serif;color:#ffffff;text-shadow:-1px -1px 1px rgba(0,0,0,.2)}.Header h1 a{color:#ffffff}.Header .description{font-size:140%;color:#aaaaaa}.header-inner .Header .titlewrapper{padding:22px 30px}.header-inner .Header .descriptionwrapper{padding:0 30px}.tabs-inner .section:first-child{border-top:1px solid #404040}.main-outer{border-top:0 solid #404040}.fauxcolumn-left-outer .fauxcolumn-inner{border-right:1px solid #404040}.fauxcolumn-right-outer .fauxcolumn-inner{border-left:1px solid #404040}div.widget>h2,div.widget h2.title{margin:0 0 1em 0;font:normal bold 11px Arial,Tahoma,Helvetica,FreeSans,sans-serif;color:#ffffff}.widget .zippy{color:#999999;text-shadow:2px 2px 1px rgba(0,0,0,.1)}h2.date-header{font:normal bold 11px Arial,Tahoma,Helvetica,FreeSans,sans-serif}.date-header span{background-color:transparent;color:#cccccc;padding:inherit;letter-spacing:inherit;margin:inherit}.main-inner{padding-top:30px;padding-bottom:30px}.main-inner .column-center-inner{padding:0 15px}.main-inner .column-center-inner .section{margin:0 15px}.post{margin:0 0 25px 0}h3.post-title{font:normal normal 20pt Arial,Tahoma,Helvetica,FreeSans,sans-serif;margin:.75em 0 0}.post-body{font-size:110%;line-height:1.4;position:relative}.post-header{margin:0 0 1.5em;line-height:1.6;font-size:90%}.post-footer{margin:20px -2px 0;padding:5px 10px;color:#888888;background-color:#303030;border-bottom:1px solid #444444;line-height:1.6;font-size:90%}.blog-pager{background:transparent none no-repeat scroll top center}.blog-pager-older-link,.home-link,.blog-pager-newer-link{background-color:#333333;padding:5px}.footer-outer{border-top:0 dashed #bbbbbb}--></style>
<style id=template-skin-1><!--body{min-width:1200px}.content-outer,.content-fauxcolumn-outer{min-width:1200px;max-width:1200px}.main-inner .columns{padding-left:0px;padding-right:260px}.main-inner .fauxcolumn-center-outer{left:0px;right:260px}.main-inner .fauxcolumn-left-outer{width:0px}.main-inner .fauxcolumn-right-outer{width:260px}.main-inner .column-left-outer{width:0px;right:100%;margin-left:-0px}.main-inner .column-right-outer{width:260px;margin-right:-260px}--></style>

<meta name=google-adsense-platform-account content=ca-host-pub-1556223355139109>
<meta name=google-adsense-platform-domain content=blogspot.com>
<meta name=referrer content=no-referrer><link href="data:image/x-icon;base64,AAABAAIAICAAAAEACACoCAAAJgAAABAQAAABAAgAaAUAAM4IAAAoAAAAIAAAAEAAAAABAAgAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAmb+AIKy/gDO4v4AWp7+AL7a/gDu9v4OInr+Dp7G/gAScv4Ajr7+AN7u/gByqv4A/v7+AAAAAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAAAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAgwMDAwMDAwMAgcAAAAAAAAAAAAAAAAAAAAAAAAJDAwMDAwMDAwMDAwMDAwJAAAAAAAAAAAAAAAAAAAACQwMDAwMDAwMDAwMDAwMDAwJAAAAAAAAAAAAAAAAAAEMDAwMDAwMDAwMDAwMDAwMDAwAAAAAAAAAAAAAAAAABwwMDAwMDAwMDAwMDAwMDAwMDAcAAAAAAAAAAAAAAAACDAwMDAwDAwMDAwMDAwwMDAwMAgAAAAAAAAAAAAAAAAwMDAwMAAAAAAAAAAAAAAwMDAwMAAAAAAAAAAAAAAAADAwMDAwMAwMDAwMDAwMMDAwMDAwAAAAAAAAAAAAAAAAMDAwMDAwMDAwMDAwMDAwMDAwMDAAAAAAAAAAAAAAAAAwMDAwMDAwMDAwMDAwMDAwMDAwMAAAAAAAAAAAAAAAADAwMDAwMDAwMDAwMDAwMDAwMDAwAAAAAAAAAAAAAAAAMDAwMDAwMDAwMDAwMDAwMDAwMCgAAAAAAAAAAAAAAAAwMDAwMDAMDAwMMDAwMDAwFAQEAAAAAAAAAAAAAAAAADAwMDAwAAAAAAAAMDAwMDAEAAAAAAAAAAAAAAAAAAAACDAwMDAwDAwMDDAwMDAwMAQAAAAAAAAAAAAAAAAAAAAcMDAwMDAwMDAwMDAwMDAwIAAAAAAAAAAAAAAAAAAAAAQwMDAwMDAwMDAwMDAwMBwAAAAAAAAAAAAAAAAAAAAAACQwMDAwMDAwMDAwMDAUGAAAAAAAAAAAAAAAAAAAAAAAACQwMDAwMDAwMDAwKAQAAAAAAAAAAAAAAAAAAAAAAAAAAAQcCDAwMDAUECwgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA///AAAADgAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAABwAAAAygAAAAQAAAAIAAAAAEACAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAACZv4CgrL+gu72/s5env5ars7+vjKC/u4Scv4ijr7+nv7+/hJuqv6Ovtr+3gAAAHIAAAD+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAcCCAgICAIHAAAAAAAAAAcICAgICAgICAcAAAAAAAACCAgDAwMDCAgCAAAAAAAACAgJAAAAAAkICAAAAAAAAAgICAgICAgICAgAAAAAAAAICAgICAgICAgIAAAAAAAACAgJAAADCAgBBQAAAAAAAAIICAMDAggIBQAAAAAAAAAHCAgICAgICgAAAAAAAAAAAAcCCAgIBAYAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAD//8ADQSCAAcADAACAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAEAAMADgAE=" rel=icon type=image/x-icon data-sf-original-href=http://blog.vmsplice.net/favicon.ico><style>.sf-hidden{display:none!important}</style><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style><noscript><link href="https://www.blogger.com/dyn-css/authorization.css?targetBlogID=4281281032294244120&amp;zx=59447eb3-da53-4845-89a3-3d0e7e61e4cb" rel="stylesheet"></noscript></head>
<body class=variant-dark>
<div class="navbar section" id=navbar><div class="widget Navbar" data-version=1 id=Navbar1>
<div id=navbar-iframe-container><iframe ng-non-bindable frameborder=0 hspace=0 marginheight=0 marginwidth=0 scrolling=no tabindex=0 vspace=0 width=100% id=navbar-iframe name=navbar-iframe data-sf-original-src="https://www.blogger.com/navbar.g?targetBlogID=4281281032294244120&amp;blogName=Stefan+Hajnoczi&amp;publishMode=PUBLISH_MODE_HOSTED&amp;navbarType=DARK&amp;layoutType=LAYOUTS&amp;searchRoot=https://blog.vmsplice.net/search&amp;blogLocale=en&amp;v=2&amp;homepageUrl=http://blog.vmsplice.net/&amp;targetPostID=8542421998121464974&amp;blogPostOrPageUrl=http://blog.vmsplice.net/2020/08/qemu-internals-event-loops.html&amp;vt=-5957038190421957587&amp;usegapi=1&amp;jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.zh_CN.nWqwurXZ_O4.O%2Fam%3DAAAg%2Fd%3D1%2Frs%3DAHpOoo-WvQyjz32iWL4IF8k0bE_E4D93qQ%2Fm%3D__features__#id=navbar-iframe&amp;_gfid=navbar-iframe&amp;parent=http%3A%2F%2Fblog.vmsplice.net&amp;pfname=&amp;rpctoken=19533691" sandbox="allow-popups allow-top-navigation allow-top-navigation-by-user-activation" srcdoc="<!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot; &quot;http://www.w3.org/TR/html4/strict.dtd&quot;> <html dir=ltr><meta charset=utf-8><style>:root{--sf-img-0: /* original URL: https://resources.blogblog.com/img/navbar/icons_gray.png */ url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAUCAMAAADFhv/OAAABTVBMVEUAAAB4eHh4eHh4eHh4eHh4eHh4eHh4eHhmZmZoaGhtbW1ubm5wcHBycnJ0dHR4eHh6enp9fX2AgICBgYGCgoKEhISGhoaHh4eIiIiJiYmKioqMjIyOjo6QkJCSkpKUlJSYmJiampqenp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqaoqKipqamqqqqrq6usrKytra2urq6vr6+zs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy+vr6/v7/AwMDBwcHCwsLDw8PFxcXHx8fIyMjJycnLy8vMzMzQ0NDR0dHT09PU1NTV1dXW1tbX19fY2Nja2trb29vc3Nzd3d3f39/g4ODh4eHi4uLj4+Pl5eXm5ubn5+fp6ent7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f5+fn6+vr7+/v8/Pz9/f3///8dVoiZAAAACHRSTlMAAAJheHnf4Xp7fcUAAAGfSURBVBgZdcHtd8tgGAfg36YvTw/t7TWboijDU9KuiCLYTGxYzVS3TmtNdKyJZPf//9GdmJyz0+W6gD/bVrPVXncR4w2jXKFlH2IuX6QTimfmEX5smFbnsbY9AGyXzhnV86oWAMjRjBy2G08HIVxHv/aBjdKVPsM31S0GCjSjAOvRAGL6Uo8A42wfgm+oHwCdAk0rQmxL7wJlgxFzVA+g2MKH/SAYr92kf9DqIPFN7wGVKhKbagcgseBzIrpGCbTbLkTk6D2AyIdgU+0AJN4zB64bMncpgXXtHAJRv/lkAiwrkwH+XL58BJAYMVeJ7jP/pgRcW9tbPafVeOEBfk3VnE9mpXQ9AEgcMH9ZWfnKzM87JADvjRZNre1DILitRFmpGoPEhFNHJAD4w93B9/1Vra1fAA97/cG4rpTBJH5yKiSB/4JV/WyKY1xXi0zCY763KOohBySQmnZdpHjNB4kh86ulpbt3HkY8IYFsJN5yqksC2UhcHPOxg6skkI1il96NPM9zNx9coBiy0SmQrUAzCsiWoxk5ZJvPF+mEYn7uL3d5bMeI9BwYAAAAAElFTkSuQmCC&quot;);--sf-img-1: /* original URL: https://resources.blogblog.com/img/navbar/arrows-dark.png */ url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAECAYAAABsgwTvAAAAL0lEQVQYV2P4jx8woOO7d+/+x4VhiogyCJ+BIHFkRUQZhM1AmBi6IqIMQjYQmQ8Aov38nU4e4yQAAAAASUVORK5CYII=&quot;)}</style><style>body{padding:0;margin:0}#b-navbar{white-space:nowrap;color:#ccc;height:29px;border-bottom:1px solid #000;background:transparent;font-size:13px;font-family:Arial,Sans-serif;position:relative}#b-navbar #b-navbar-bg{position:absolute;left:0;top:0;width:100%;height:30px;background-color:#000;opacity:.4}#b-navbar .navbar-right{text-align:right;padding-right:5px}#b-navbar-controls{margin-left:.2em;height:29px}#b-navbar #b-navbar-logo{display:block;margin-right:8px;margin-left:8px;width:20px;height:20px;background:var(--sf-img-0) no-repeat -26px 0;cursor:pointer}#b-navbar #b-query-box{background-color:#fff;margin:0 .5em 0 0;border:1px solid #014;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px;padding:0 .3em}#b-navbar #b-query-icon{display:block;width:13px;height:13px;cursor:pointer;background:var(--sf-img-0) no-repeat 0 0}#b-navbar #b-query-icon:hover{background:var(--sf-img-0) no-repeat -13px 0}#b-navbar #b-query{font-size:13px;color:#000;background-color:transparent;border:none;margin:0}#b-navbar .b-link{display:inline-block;font-size:13px;vertical-align:middle;padding:2px .4em}#b-navbar .b-link{color:#ddd;text-decoration:none;white-space:nowrap;cursor:pointer}#b-navbar .b-link:hover{color:#fff;text-decoration:underline}#b-navbar #b-more span.arrow{background:var(--sf-img-1) no-repeat -12px;display:inline-block;width:7px;height:10px}#b-navbar #b-more:hover span.arrow{background:var(--sf-img-1) no-repeat 0}</style>
<meta name=referrer content=no-referrer><meta http-equiv=content-security-policy content=&quot;default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;&quot;><style>img[src=&quot;data:,&quot;],source[src=&quot;data:,&quot;]{display:none!important}</style></head>
<body class=&quot;lang_zh rb&quot;>
<div id=b-navbar><div id=b-navbar-bg style=z-index:-1></div>
<div id=b-navbar-fg><table id=b-navbar-controls cellpadding=0 cellspacing=0 border=0 width=100%><tbody><tr style=height:20px><td valign=middle width=24px><a href=https://www.blogger.com/ id=b-navbar-logo tabindex=1 title=&quot;转到 Blogger.com&quot;></a></td>
<td valign=middle width=150px><form id=searchthis action=https://blog.vmsplice.net/search style=display:inline><div id=b-query-box><table cellpadding=0 cellspacing=0><tbody><tr><td valign=middle><input type=text id=b-query name=q tabindex=3 style=width:120px title=搜索 value></td>
<td valign=middle style=width:15px><a id=b-query-icon title=搜索此博客></a></table></div>
</form></td>
<td valign=middle nowrap class=gplus><a id=b-more class=b-link tabindex=4>更多
<span class=arrow></span></a></td>
<td class=navbar-right align=right nowrap valign=middle><a class=b-link href=https://www.blogger.com/home#create id=b-getorpost tabindex=8>创建博客</a>
<a class=b-link href=https://www.blogger.com/ tabindex=9>登录</a></table></div></div>
"></iframe></div>
</div></div>
<div class=body-fauxcolumns>
<div class="fauxcolumn-outer body-fauxcolumn-outer">
<div class=cap-top>
<div class=cap-left></div>
<div class=cap-right></div>
</div>
<div class=fauxborder-left>
<div class=fauxborder-right></div>
<div class=fauxcolumn-inner>
</div>
</div>
<div class=cap-bottom>
<div class=cap-left></div>
<div class=cap-right></div>
</div>
</div>
</div>
<div class=content>
<div class=content-fauxcolumns>
<div class="fauxcolumn-outer content-fauxcolumn-outer">
<div class=cap-top>
<div class=cap-left></div>
<div class=cap-right></div>
</div>
<div class=fauxborder-left>
<div class=fauxborder-right></div>
<div class=fauxcolumn-inner>
</div>
</div>
<div class=cap-bottom>
<div class=cap-left></div>
<div class=cap-right></div>
</div>
</div>
</div>
<div class=content-outer>
<div class="content-cap-top cap-top">
<div class=cap-left></div>
<div class=cap-right></div>
</div>
<div class="fauxborder-left content-fauxborder-left">
<div class="fauxborder-right content-fauxborder-right"></div>
<div class=content-inner>
<header>
<div class=header-outer>
<div class="header-cap-top cap-top">
<div class=cap-left></div>
<div class=cap-right></div>
</div>
<div class="fauxborder-left header-fauxborder-left">
<div class="fauxborder-right header-fauxborder-right"></div>
<div class="region-inner header-inner">
<div class="header section" id=header><div class="widget Header" data-version=1 id=Header1>
<div id=header-inner>
<div class=titlewrapper>
<h1 class=title>
<a href=http://blog.vmsplice.net/>
Stefan Hajnoczi
</a>
</h1>
</div>
<div class=descriptionwrapper>
<p class=description><span>Open source and virtualization blog</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class="header-cap-bottom cap-bottom">
<div class=cap-left></div>
<div class=cap-right></div>
</div>
</div>
</header>
<div class=tabs-outer>
<div class="tabs-cap-top cap-top">
<div class=cap-left></div>
<div class=cap-right></div>
</div>
<div class="fauxborder-left tabs-fauxborder-left">
<div class="fauxborder-right tabs-fauxborder-right"></div>
<div class="region-inner tabs-inner">
<div class="tabs no-items section" id=crosscol></div>
<div class="tabs no-items section" id=crosscol-overflow></div>
</div>
</div>
<div class="tabs-cap-bottom cap-bottom">
<div class=cap-left></div>
<div class=cap-right></div>
</div>
</div>
<div class=main-outer>
<div class="main-cap-top cap-top">
<div class=cap-left></div>
<div class=cap-right></div>
</div>
<div class="fauxborder-left main-fauxborder-left">
<div class="fauxborder-right main-fauxborder-right"></div>
<div class="region-inner main-inner">
<div class="columns fauxcolumns">
<div class="fauxcolumn-outer fauxcolumn-center-outer">
<div class=cap-top>
<div class=cap-left></div>
<div class=cap-right></div>
</div>
<div class=fauxborder-left>
<div class=fauxborder-right></div>
<div class=fauxcolumn-inner>
</div>
</div>
<div class=cap-bottom>
<div class=cap-left></div>
<div class=cap-right></div>
</div>
</div>
<div class="fauxcolumn-outer fauxcolumn-left-outer">
<div class=cap-top>
<div class=cap-left></div>
<div class=cap-right></div>
</div>
<div class=fauxborder-left>
<div class=fauxborder-right></div>
<div class=fauxcolumn-inner>
</div>
</div>
<div class=cap-bottom>
<div class=cap-left></div>
<div class=cap-right></div>
</div>
</div>
<div class="fauxcolumn-outer fauxcolumn-right-outer">
<div class=cap-top>
<div class=cap-left></div>
<div class=cap-right></div>
</div>
<div class=fauxborder-left>
<div class=fauxborder-right></div>
<div class=fauxcolumn-inner>
</div>
</div>
<div class=cap-bottom>
<div class=cap-left></div>
<div class=cap-right></div>
</div>
</div>
<div class=columns-inner>
<div class=column-center-outer>
<div class=column-center-inner>
<div class="main section" id=main><div class="widget Blog" data-version=1 id=Blog1>
<div class="blog-posts hfeed">
 <div class=date-outer>
 
<h2 class=date-header><span>Monday, August 24, 2020</span></h2>
 <div class=date-posts>
 
<div class=post-outer>
<div class="post hentry">
<a name=8542421998121464974></a>
<h3 class="post-title entry-title">
QEMU Internals: Event loops
</h3>
<div class=post-header>
<div class=post-header-line-1></div>
</div>
<div class="post-body entry-content">
<p>This post explains event loops in QEMU v5.1.0 and their unique features
 compared to other event loop implementations. The APIs are not covered
 in detail here since they are explained in doc comments. Instead, the
 focus is on the big picture and why things work the way they do.</p>
 <p>Event loops are central to many I/O-bound applications like network
 services and graphical desktop applications. QEMU also has I/O-bound
 work that fits well into an event loop. Examples include the QMP monitor,
 disk I/O, and timers.</p>
 <p>An event loop monitors <i>event sources</i> for activity and invokes
 a callback function when an event occurs. This makes it possible to
 process multiple event sources within a single CPU thread. The
 application can appear to do multiple things at once without
 multithreading because it switches between handling different event
 sources. This architecture is common in Javascript, Python
 Twisted/asyncio, and many other environments. Sometimes the event loop
 is hidden underneath coroutines or async/await language features (<a href=http://blog.vmsplice.net/2014/01/coroutines-in-qemu-basics.html>QEMU
 has coroutines</a> but often the event loop is still used directly).
 <p>The most important event sources in QEMU are:
 <ul>
 <li>File descriptors such as sockets and character devices.</li>
 <li>Event notifiers (implemented as eventfds on Linux).</li>
 <li>Timers for delayed function execution.</li>
 <li>Bottom-halves (BHs) for invoking a function in another thread or deferring a function call to avoid reentrancy.</li>
 </ul>
 <p></p>
 <h2>Event loops and threads</h2>
 <p>QEMU has several different types of threads:
 <ul>
 <li>vCPU threads that execute guest code and perform device emulation synchronously with respect to the vCPU.</li>
 <li>The main loop that runs the event loops (yes, there is more than one!) used by many QEMU components.</li>
 <li>IOThreads that run event loops for device emulation concurrently with vCPUs and "out-of-band" QMP monitor commands.</li>
 </ul>
 <p></p>
 <p>It's worth explaining how device emulation interacts with threads. When
 guest code accesses a device register the vCPU thread traps the access
 and dispatches it to an emulated device. The device's read/write
 function runs in the vCPU thread. The vCPU thread cannot resume guest code
 execution until the device's read/write function returns. This means
 long-running operations like emulating a timer chip or disk I/O cannot
 be performed synchronously in the vCPU thread since they would block the vCPU. Most
 devices solve this problem using the main loop thread's event loops.
 They add timer or file descriptor monitoring callbacks to the main loop
 and return back to guest code execution. When the timer expires or the file
 descriptor becomes ready the callback function runs in the main loop
 thread. The final part of emulating a guest timer or disk access
 therefore runs in the main loop thread and not a vCPU thread.</p>
 <p>Some devices perform the guest device register access in the main
 loop thread or an IOThread thanks to ioeventfd. ioeventfd is a Linux
 KVM API and also has a userspace fallback implementation for TCG that
 traps vCPU device accesses and writes to a file descriptor so another
 thread can handle the access.</p>
 <p>The key point is that vCPU threads do not run an event loop. The
 main loop thread and IOThreads run event loops. vCPU threads can add
 event sources to the main loop or IOThread event loops. Callbacks run
 in the main loop thread or IOThreads.</p>
 <h2>How the main loop and IOThreads differ</h2>
 <p>The main loop and IOThreads share some code but are fundamentally
 different. The common code is called AioContext and is QEMU's native
 event loop API. Commonly-used functions include <tt>aio_set_fd_handler()</tt>,
 <tt>aio_set_event_handler()</tt>, <tt>aio_timer_init()</tt>, and <tt>aio_bh_new()</tt>.</p>
 <p>The main loop actually has a glib GMainContext
 and two AioContext event loops. QEMU components can use any of these
 event loop APIs and the main loop combines them all into a single event
 loop function <a href=http://blog.vmsplice.net/2020/08/qemu-internals-event-loops.html https: gitlab.com qemu-project qemu - blob v5.1.0 util main-loop.c#l223>os_host_main_loop_wait()</a>
 that calls <a href=https://gitlab.com/qemu-project/qemu/-/blob/v5.1.0/util/qemu-timer.c#L331>qemu_poll_ns()</a>
 to wait for
 event sources. This makes it possible to combine glib-based code with
 code using the native QEMU AioContext APIs.</p>
 <p>The reason why the main loop has two AioContexts is because one,
 called <tt>iohandler_ctx</tt>, is used to implement older
 <tt>qemu_set_fd_handler()</tt> APIs whose handlers should not run when
 the other AioContext, called <tt>qemu_aio_context</tt>, is run using
 <tt>aio_poll()</tt>. The QEMU block layer and newer code uses
 <tt>qemu_aio_context</tt> while older code uses <tt>iohandler_ctx</tt>. Over time it may
 be possible to unify the two by converting <tt>iohandler_ctx</tt> handlers to
 safely execute in <tt>qemu_aio_context</tt>.</p>
 <p>IOThreads have an AioContext and a glib GMainContext. The AioContext
 is run using the <tt>aio_poll()</tt> API, which enables the advanced
 features of the event loop. If a glib event loop is needed then the
 GMainContext can be run using <tt>g_main_loop_run()</tt> and the
 AioContext event sources will be included.</p>
 <p>Code that relies on the AioContext aio_*() APIs will work with both
 the main loop and IOThreads. Older code using qemu_*() APIs only works
 with the main loop. glib code works with both the main loop and
 IOThreads.</p>
 <p>The key difference between the main loop and IOThreads is that the
 main loop uses a traditional event loop that calls
 <tt>qemu_poll_ns()</tt> while IOThreads AioContext <tt>aio_poll()</tt>
 has advanced features that result in better performance.</p>
 <h2>AioContext features</h2>
 <p>AioContext has the following event loop features that traditional event loops do not have:
 <ul>
 <li><a href=https://vmsplice.net/~stefan/stefanha-kvm-forum-2017.pdf>Adaptive polling support</a> for lower latency but slightly higher CPU consumption. AioContext event sources can have a userspace polling function that detects events without performing syscalls (e.g. peeking at a memory location). This allows the event loop to avoid block syscalls that might lead the host kernel scheduler to yield the thread and put the physical CPU into a low power state. Keeping the CPU busy and avoiding entering the kernel minimizes latency.</li>
 <li>O(1) time complexity with respect to the number of monitored file descriptors. When there are thousands of file descriptors O(n) APIs like <tt>poll(2)</tt> spend time scanning over all file descriptors, even those that have no activity. This scalability bottleneck can be avoided with Linux io_uring and epoll APIs, both of which are supported by AioContext <tt>aio_poll(2)</tt>.</li>
 <li>Nanosecond timers. glib's event loop only has millisecond timers, which is not sufficient for emulating hardware timers.</li>
 </ul>
 <p></p>
 <p>These features are required for performance reasons. Unfortunately glib's event loop does not support them, otherwise QEMU could use GMainContext as its only event loop.</p>
 <h2>Conclusion</h2>
 <p>QEMU uses both its native AioContext event loop and glib's GMainContext. The QEMU main loop and IOThreads work differently, with IOThreads offering the best performance thanks to its AioContext <tt>aio_poll()</tt> event loop. Modern QEMU code should use AioContext APIs for optimal performance and so that the code can be used in both the main loop and IOThreads.</p>
<div style=clear:both></div>
</div>
<div class=post-footer>
<div class="post-footer-line post-footer-line-1"><span class="post-author vcard">
Posted by
<span class=fn>stefanha</span>
</span>
<span class=post-timestamp>
at
<a class=timestamp-link href=http://blog.vmsplice.net/2020/08/qemu-internals-event-loops.html rel=bookmark title="permanent link"><abbr class=published title=2020-08-24T07:52:00+01:00>7:52 AM</abbr></a>
</span>
<span class=post-comment-link>
</span>
<span class=post-icons>
<span class="item-control blog-admin pid-1056005731 sf-hidden">
</span>
</span>
<div class=post-share-buttons>
<a class="goog-inline-block share-button sb-email" href="https://www.blogger.com/share-post.g?blogID=4281281032294244120&amp;postID=8542421998121464974&amp;target=email" target=_blank title="Email This"><span class=share-button-link-text>Email This</span></a><a class="goog-inline-block share-button sb-blog" href="https://www.blogger.com/share-post.g?blogID=4281281032294244120&amp;postID=8542421998121464974&amp;target=blog" target=_blank title=BlogThis!><span class=share-button-link-text>BlogThis!</span></a><a class="goog-inline-block share-button sb-twitter" href="https://www.blogger.com/share-post.g?blogID=4281281032294244120&amp;postID=8542421998121464974&amp;target=twitter" target=_blank title="Share to Twitter"><span class=share-button-link-text>Share to Twitter</span></a><a class="goog-inline-block share-button sb-facebook" href="https://www.blogger.com/share-post.g?blogID=4281281032294244120&amp;postID=8542421998121464974&amp;target=facebook" target=_blank title="Share to Facebook"><span class=share-button-link-text>Share to Facebook</span></a><a class="goog-inline-block share-button sb-pinterest" href="https://www.blogger.com/share-post.g?blogID=4281281032294244120&amp;postID=8542421998121464974&amp;target=pinterest" target=_blank title="Share to Pinterest"><span class=share-button-link-text>Share to Pinterest</span></a>
</div>
</div>
<div class="post-footer-line post-footer-line-2"><span class=post-labels>
Labels:
<a href=http://blog.vmsplice.net/search/label/internals rel=tag>internals</a>,
<a href=http://blog.vmsplice.net/search/label/qemu rel=tag>qemu</a>
</span>
</div>
<div class="post-footer-line post-footer-line-3"><span class=post-location>
</span>
</div>
</div>
</div>
<div class=comments id=comments>
<a name=comments></a>
</div>
</div>
 </div></div>
 
</div>
<div class=blog-pager id=blog-pager>
<span id=blog-pager-newer-link>
<a class=blog-pager-newer-link href=http://blog.vmsplice.net/2020/08/using-kcov-code-coverage-with-meson.html id=Blog1_blog-pager-newer-link title="Newer Post">Newer Post</a>
</span>
<span id=blog-pager-older-link>
<a class=blog-pager-older-link href=http://blog.vmsplice.net/2020/08/why-qemu-should-move-from-c-to-rust.html id=Blog1_blog-pager-older-link title="Older Post">Older Post</a>
</span>
<a class=home-link href=http://blog.vmsplice.net/>Home</a>
</div>
<div class=clear></div>
<div class=post-feeds>
</div>
</div></div>
</div>
</div>
<div class=column-left-outer>
<div class=column-left-inner>
<aside>
</aside>
</div>
</div>
<div class=column-right-outer>
<div class=column-right-inner>
<aside>
<div class="sidebar section" id=sidebar-right-1><div class="widget BlogArchive" data-version=1 id=BlogArchive1>
<h2>Blog Archive</h2>
<div class=widget-content>
<div id=ArchiveList>
<div id=BlogArchive1_ArchiveList>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2024/>
2024
</a>
<span class=post-count dir=ltr>(5)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2023/>
2023
</a>
<span class=post-count dir=ltr>(7)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2022/>
2022
</a>
<span class=post-count dir=ltr>(6)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2021/>
2021
</a>
<span class=post-count dir=ltr>(12)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate expanded">
<a class=toggle href=javascript:void(0)>
<span class="zippy toggle-open">
 ▼&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2020/>
2020
</a>
<span class=post-count dir=ltr>(20)</span>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2020/12/>
December
</a>
<span class=post-count dir=ltr>(3)</span>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2020/11/>
November
</a>
<span class=post-count dir=ltr>(2)</span>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2020/10/>
October
</a>
<span class=post-count dir=ltr>(1)</span>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2020/09/>
September
</a>
<span class=post-count dir=ltr>(2)</span>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate expanded">
<a class=toggle href=javascript:void(0)>
<span class="zippy toggle-open">
 ▼&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2020/08/>
August
</a>
<span class=post-count dir=ltr>(3)</span>
<ul class=posts>
<li><a href=http://blog.vmsplice.net/2020/08/using-kcov-code-coverage-with-meson.html>Using kcov code coverage with meson</a></li>
<li><a href=http://blog.vmsplice.net/2020/08/qemu-internals-event-loops.html>QEMU Internals: Event loops</a></li>
<li><a href=http://blog.vmsplice.net/2020/08/why-qemu-should-move-from-c-to-rust.html>Why QEMU should move from C to Rust</a></li>
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2020/07/>
July
</a>
<span class=post-count dir=ltr>(2)</span>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2020/05/>
May
</a>
<span class=post-count dir=ltr>(1)</span>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2020/04/>
April
</a>
<span class=post-count dir=ltr>(2)</span>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2020/02/>
February
</a>
<span class=post-count dir=ltr>(4)</span>
</li>
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2019/>
2019
</a>
<span class=post-count dir=ltr>(8)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2018/>
2018
</a>
<span class=post-count dir=ltr>(4)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2017/>
2017
</a>
<span class=post-count dir=ltr>(6)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2016/>
2016
</a>
<span class=post-count dir=ltr>(6)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2015/>
2015
</a>
<span class=post-count dir=ltr>(8)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2014/>
2014
</a>
<span class=post-count dir=ltr>(5)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2013/>
2013
</a>
<span class=post-count dir=ltr>(7)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2012/>
2012
</a>
<span class=post-count dir=ltr>(3)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
<ul class=hierarchy>
<li class="archivedate collapsed">
<a class=toggle href=javascript:void(0)>
<span class=zippy>
 ►&nbsp;
 
</span>
</a>
<a class=post-count-link href=http://blog.vmsplice.net/2011/>
2011
</a>
<span class=post-count dir=ltr>(26)</span>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
<ul class="hierarchy sf-hidden">
</ul>
</li>
</ul>
</div>
</div>
<div class=clear></div>
</div>
</div><div class="widget Label" data-version=1 id=Label1>
<h2>Labels</h2>
<div class="widget-content list-label-widget-content">
<ul>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/block>block</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/flatpak>flatpak</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/git>git</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/gsoc>gsoc</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/internals>internals</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/kubernetes>kubernetes</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/kubevirt>kubevirt</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/kvm>kvm</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/libvirt>libvirt</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/linux>linux</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/nbd>nbd</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/qemu>qemu</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/tracing>tracing</a>
</li>
<li>
<a dir=ltr href=http://blog.vmsplice.net/search/label/virtio>virtio</a>
</li>
</ul>
<div class=clear></div>
</div>
</div><div class="widget Text" data-version=1 id=Text1>
<h2 class=title>About me</h2>
<div class=widget-content>
<div>I am an open source developer and contribute to QEMU and KVM. I work at Red Hat. The postings on this site are my own and don’t necessarily represent Red Hat’s positions, strategies or opinions.</div>
</div>
<div class=clear></div>
</div></div>
</aside>
</div>
</div>
</div>
<div style=clear:both></div>
</div>
</div>
</div>
<div class="main-cap-bottom cap-bottom">
<div class=cap-left></div>
<div class=cap-right></div>
</div>
</div>
<footer>
<div class=footer-outer>
<div class="footer-cap-top cap-top">
<div class=cap-left></div>
<div class=cap-right></div>
</div>
<div class="fauxborder-left footer-fauxborder-left">
<div class="fauxborder-right footer-fauxborder-right"></div>
<div class="region-inner footer-inner">
<div class="foot section" id=footer-1><div class="widget Text" data-version=1 id=Text2>
<h2 class=title>Have a question?</h2>
<div class=widget-content>
Please email qemu-devel@nongnu.org and CC stefanha@gmail.com with your question about this blog post. This way others can participate in the discussion on the QEMU mailing list.<br>
</div>
<div class=clear></div>
</div></div>
<div class="foot section" id=footer-3><div class="widget Attribution" data-version=1 id=Attribution1>
<div class=widget-content style=text-align:center>
Simple theme. Powered by <a href=https://www.blogger.com/ target=_blank>Blogger</a>.
</div>
<div class=clear></div>
</div></div>
</div>
</div>
<div class="footer-cap-bottom cap-bottom">
<div class=cap-left></div>
<div class=cap-right></div>
</div>
</div>
</footer>
</div>
</div>
<div class="content-cap-bottom cap-bottom">
<div class=cap-left></div>
<div class=cap-right></div>
</div>
</div>
</div>
<div style=all:initial><div style=all:initial id=__hcfy__><template shadowrootmode=open><style class=sf-hidden>#root{-webkit-text-size-adjust:100%;box-sizing:border-box;font-size:14px;font-weight:400;letter-spacing:0;line-height:1.28581;text-transform:none;color:#182026;font-family:-apple-system,"BlinkMacSystemFont","Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Open Sans","Helvetica Neue","Icons16",sans-serif;touch-action:manipulation}#root>.bp5-portal{z-index:9999999999}</style><style class=sf-hidden>#translate-panel{background-color:#f6f7f9;display:flex;flex-direction:column;padding-bottom:8px}.bp5-dark #translate-panel{background-color:#252a31}#translate-panel .fixed{flex-shrink:0;margin-bottom:10px}#translate-panel .body{flex-grow:1;overflow:auto;overscroll-behavior:contain}#translate-panel .body::-webkit-scrollbar{width:8px;background-color:rgba(0,0,0,0);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar:hover{background-color:rgba(0,0,0,.09)}#translate-panel .body::-webkit-scrollbar-thumb:vertical{background:rgba(0,0,0,.5);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar-thumb:vertical:active{background:rgba(0,0,0,.61);-webkit-border-radius:100px}#translate-panel.size-small,#translate-panel.size-small h6.bp5-heading,#translate-panel.size-small .bp5-control.bp5-large,#translate-panel.size-small textarea.bp5-input.bp5-small{font-size:14px}#translate-panel.size-small .phonetic-item,#translate-panel.size-small .quick-settings a{font-size:12px}#translate-panel.size-middle,#translate-panel.size-middle h6.bp5-heading,#translate-panel.size-middle .bp5-control.bp5-large,#translate-panel.size-middle textarea.bp5-input{font-size:18px}#translate-panel.size-middle .phonetic-item,#translate-panel.size-middle .quick-settings a{font-size:14px}#translate-panel.size-large,#translate-panel.size-large h6.bp5-heading,#translate-panel.size-large .bp5-control.bp5-large,#translate-panel.size-large textarea.bp5-input.bp5-large{font-size:22px}#translate-panel.size-large .source,#translate-panel.size-large .phonetic-item,#translate-panel.size-large .quick-settings a{font-size:18px}#translate-panel .bp5-button.bp5-small,#translate-panel .bp5-small .bp5-button{min-height:20px;min-width:20px}#translate-panel .header{display:flex;align-items:center;padding:4px 6px 4px 10px;border-bottom:1px solid #d1d1d1}.bp5-dark #translate-panel .header{border-bottom-color:rgba(17,20,24,.4)}#translate-panel .header .drag-block{min-width:5px;flex-shrink:0;flex-grow:1;align-self:stretch}#translate-panel .header .left{flex-shrink:0;display:flex}#translate-panel .header .right{flex-shrink:0;display:flex;align-items:center}#translate-panel .header .right .bp5-icon-arrow-right{flex-shrink:0;margin:0 5px}#translate-panel .header .right>.bp5-button{flex-shrink:0;margin:0 1px}#translate-panel .header .right>.bp5-button:last-child{margin-right:0}#translate-panel .quick-settings{padding:4px 9px;margin:0 1px}#translate-panel .quick-settings>div{margin-bottom:5px}#translate-panel .quick-settings .bp5-control{margin-bottom:0}#translate-panel .query-text{position:relative;padding:10px 10px 2px 10px}#translate-panel .query-text textarea.bp5-input{min-height:44px;font-family:system-ui,-apple-system,"Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";overscroll-behavior:contain}#translate-panel .query-text .translate-btn{position:absolute;opacity:.6}#translate-panel .query-text .translate-btn:hover{opacity:1}#translate-panel .body{padding:0 10px}#translate-panel .body .bp5-card:first-child{margin-top:1px}#translate-panel .body .bp5-card:last-child{margin-bottom:1px}#translate-panel .body .no-api{margin:20px 0}.result-block{margin:8px 0;padding:2px 5px}.result-block .bp5-button{visibility:hidden}.result-block .error .bp5-button,.result-block:hover .bp5-button{visibility:visible}.result-block .legend{display:flex;align-items:center;justify-content:space-between}.result-block .legend .legend-left{display:flex;align-items:center}.result-block .legend .api-ico,.result-block .legend .bp5-heading{flex-shrink:0;white-space:nowrap}.result-block .legend .api-ico{display:inline-block;width:14px;height:14px;background-size:contain;margin-right:3px}.result-block .legend .bp5-heading{margin-bottom:0;margin-right:10px}.result-block .legend .source{cursor:pointer;font-size:12px;display:inline-flex;align-items:center}.result-block .legend .source .source-text{overflow:hidden}.result-block .legend .source .bp5-icon{position:relative;top:-1px;margin-left:1px}.result-block .phonetic{display:flex;flex-wrap:wrap}.result-block .phonetic .phonetic-item{display:flex;align-items:center;font-size:12px}.result-block .phonetic .phonetic-item:not(:last-child){margin-right:12px}.result-block .common-result p{line-height:1.3;margin:2px 0;overflow-wrap:break-word}.result-block .common-result .dict a{text-decoration:underline}.result-block .error{font-size:12px;padding:5px 10px}.result-block .dict-pos{margin-right:5px}.external-translators{margin-bottom:3px;padding:0;display:flex;flex-wrap:wrap}.external-translators>div{margin:0 5px 5px 0}.quick-links a{margin:0 5px 5px 0}#popper-container{width:250px;max-width:100%;position:absolute;left:0;top:0;z-index:9999999998;touch-action:none;transition:opacity .2s;background-color:#f6f7f9}.bp5-dark #popper-container{background-color:#252a31}#popper-container.show{opacity:1;pointer-events:auto;-moz-user-select:auto;user-select:auto}#popper-container,#popper-container[data-popper-reference-hidden=true]{opacity:0;pointer-events:none;-moz-user-select:none;user-select:none}#popper-container .drag-block{cursor:-webkit-grab;cursor:grab}#popper-container.pin{position:fixed}#popper-container.pin .arrow{display:none}#popper-container .arrow,#popper-container .arrow::before{position:absolute;width:8px;height:8px;z-index:-1}#popper-container .arrow::before{content:"";transform:rotate(45deg);background:#f6f7f9}.bp5-dark #popper-container .arrow::before{background-color:#252a31}#popper-container .arrow{display:none}#popper-container.show[data-popper-placement]:not([data-popper-reference-hidden=true]) .arrow{display:block}#popper-container[data-popper-placement^=top] .arrow{bottom:-5px}#popper-container[data-popper-placement^=top] .arrow::before{border-right:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#popper-container[data-popper-placement^=bottom] .arrow{top:-5px}#popper-container[data-popper-placement^=bottom] .arrow::before{border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=left] .arrow{right:-5px}#popper-container[data-popper-placement^=left] .arrow::before{border-right:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=right] .arrow{left:-5px}#popper-container[data-popper-placement^=right] .arrow::before{border-left:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#translate-btn{display:none;position:absolute;z-index:9999999999;left:0;top:0}#translate-btn .bp5-button{padding:2px;min-width:0;min-height:0}#translate-btn .btn-icon{width:18px;height:18px;background-image:url(moz-extension://72d6ca68-5609-1440-b1ba-15daf8cbdb2d/logo.png);background-size:contain}.bp5-dark #translate-btn .btn-icon{background-image:url(moz-extension://72d6ca68-5609-1440-b1ba-15daf8cbdb2d/logowhite36.png)}#translate-btn.show{display:block}.translate-type-selector .bp5-label{display:inline}.translate-type-selector .bp5-radio{margin-bottom:0}#ocr-container{position:fixed;z-index:99999999999999;left:0;top:0;right:0;bottom:0}#ocr-container .toolbar{display:none;position:absolute;z-index:1}#ocr-container img{max-width:100%}#app{cursor:default}.switch-pin{flex-shrink:0;cursor:pointer}.switch-pin .bp5-icon-pin{transition:transform .2s,color .2s;transform:rotate(-45deg)}.pin .switch-pin .bp5-icon-pin{transform:rotate(-70deg)}.cut-btn{margin-left:2px}.app-toaster-container{position:fixed!important;z-index:9999999999!important}.app-toaster-container .bp5-toast{min-width:auto}#web-trs-panel .app-toaster-container{padding-right:0;padding-left:0}#web-trs-panel .page-trs-form-group{margin:0 0 0 0;align-items:center}#web-trs-panel .page-trs-form-group>label{width:70px}</style><div id=root dir=ltr class=bp5-dark><div id=app class=bp5-dark><div id=translate-btn class=sf-hidden></div><div id=popper-container style=width:250px;transform:translate(0px) class=bp5-elevation-4><div id=translate-panel class=size-small><div class=fixed><div class=header><div class=left><div class=switch-pin><button type=button class="bp5-button bp5-minimal bp5-small"><span aria-hidden=true class="bp5-icon bp5-icon-pin"><svg data-icon=pin height=14 role=img viewBox="0 0 16 16" width=14><path d="M9.41.92c-.51.51-.41 1.5.15 2.56L4.34 7.54C2.8 6.48 1.45 6.05.92 6.58l3.54 3.54-3.54 4.95 4.95-3.54 3.54 3.54c.53-.53.1-1.88-.96-3.42l4.06-5.22c1.06.56 2.04.66 2.55.15L9.41.92z" fill-rule=evenodd></path></svg></span></button></div><button type=button class="bp5-button bp5-minimal bp5-small cut-btn" title=截图翻译><span aria-hidden=true class="bp5-icon bp5-icon-cut"><svg data-icon=cut height=14 role=img viewBox="0 0 16 16" width=14><path d="M13 2s.71-1.29 0-2L8.66 5.07l1.05 1.32L13 2zm.07 8c-.42 0-.82.09-1.18.26L3.31 0c-.69.71 0 2 0 2l3.68 5.02-2.77 3.24A2.996 2.996 0 000 13c0 1.66 1.34 3 3 3s3-1.34 3-3c0-.46-.11-.89-.29-1.27L8.1 8.54l2.33 3.19c-.18.39-.29.82-.29 1.27 0 1.66 1.31 3 2.93 3S16 14.66 16 13s-1.31-3-2.93-3zM3 14c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm10.07 0c-.54 0-.98-.45-.98-1s.44-1 .98-1 .98.45.98 1-.44 1-.98 1z" fill-rule=evenodd></path></svg></span></button><button type=button class="bp5-button bp5-minimal bp5-small cut-btn" title=网页全文翻译><span aria-hidden=true class="bp5-icon bp5-icon-translate"><svg data-icon=translate height=14 role=img viewBox="0 0 16 16" width=14><path d="M15.89 14.56l-3.99-8h-.01c-.17-.33-.5-.56-.89-.56s-.72.23-.89.56h-.01L9 8.76 7.17 7.38l.23-.18C8.37 6.47 9 5.31 9 4V3h1c.55 0 1-.45 1-1s-.45-1-1-1H7c0-.55-.45-1-1-1H5c-.55 0-1 .45-1 1H1c-.55 0-1 .45-1 1s.45 1 1 1h6v1c0 .66-.32 1.25-.82 1.61l-.68.51-.68-.5C4.32 5.25 4 4.66 4 4H2c0 1.31.63 2.47 1.6 3.2l.23.17L1.4 9.2l.01.01C1.17 9.4 1 9.67 1 10c0 .55.45 1 1 1 .23 0 .42-.09.59-.21l.01.01 2.9-2.17 2.6 1.95-1.99 3.98h.01c-.07.13-.12.28-.12.44 0 .55.45 1 1 1 .39 0 .72-.23.89-.56h.01L8.62 14h4.76l.72 1.45h.01c.17.32.5.55.89.55.55 0 1-.45 1-1 0-.16-.05-.31-.11-.44zM9.62 12L11 9.24 12.38 12H9.62z" fill-rule=evenodd></path></svg></span></button><button type=button class="bp5-button bp5-minimal bp5-small cut-btn" title=音视频翻译 style=margin-right:2px><span aria-hidden=true class="bp5-icon bp5-icon-video"><svg data-icon=video height=14 role=img viewBox="0 0 16 16" width=14><path d="M15 2H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h14c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zM5 11V5l6 3-6 3z" fill-rule=evenodd></path></svg></span></button><button type=button title=图片翻译 class="bp5-button bp5-minimal bp5-small"><span aria-hidden=true class="bp5-icon bp5-icon-media"><svg data-icon=media height=14 role=img viewBox="0 0 16 16" width=14><path d="M11.99 6.99c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm3-5h-14c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-10c0-.55-.45-1-1-1zm-1 9l-5-3-1 2-3-4-3 5v-7h12v7z" fill-rule=evenodd></path></svg></span></button><button type=button title=语音翻译 class="bp5-button bp5-minimal bp5-small"><span class=bp5-icon><svg version=1.1 id=Capa_1 width=14 height=14 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink x=0px y=0px viewBox="0 0 490.9 490.9" xml:space=preserve><g><g><path d="M245.5,322.9c53,0,96.2-43.2,96.2-96.2V96.2c0-53-43.2-96.2-96.2-96.2s-96.2,43.2-96.2,96.2v130.5 C149.3,279.8,192.5,322.9,245.5,322.9z M173.8,96.2c0-39.5,32.2-71.7,71.7-71.7s71.7,32.2,71.7,71.7v130.5 c0,39.5-32.2,71.7-71.7,71.7s-71.7-32.2-71.7-71.7V96.2z"></path><path d="M94.4,214.5c-6.8,0-12.3,5.5-12.3,12.3c0,85.9,66.7,156.6,151.1,162.8v76.7h-63.9c-6.8,0-12.3,5.5-12.3,12.3 s5.5,12.3,12.3,12.3h152.3c6.8,0,12.3-5.5,12.3-12.3s-5.5-12.3-12.3-12.3h-63.9v-76.7c84.4-6.3,151.1-76.9,151.1-162.8 c0-6.8-5.5-12.3-12.3-12.3s-12.3,5.5-12.3,12.3c0,76.6-62.3,138.9-138.9,138.9s-138.9-62.3-138.9-138.9 C106.6,220,101.2,214.5,94.4,214.5z"></path></g></g></svg></span></button></div><div class=drag-block title=按住不放可以拖动></div><div class=right><button type=button disabled title=添加到收藏夹 class="bp5-button bp5-disabled bp5-minimal bp5-small" tabindex=-1><span aria-hidden=true class="bp5-icon bp5-icon-star-empty"><svg data-icon=star-empty height=14 role=img viewBox="0 0 16 16" width=14><path d="M16 6.11l-5.53-.84L8 0 5.53 5.27 0 6.11l4 4.1L3.06 16 8 13.27 12.94 16 12 10.21l4-4.1zM4.91 13.2l.59-3.62L3 7.02l3.45-.53L8 3.2l1.55 3.29 3.45.53-2.5 2.56.59 3.62L8 11.49 4.91 13.2z" fill-rule=evenodd></path></svg></span></button><button type=button class="bp5-button bp5-minimal bp5-small settings" title=快捷设置><span aria-hidden=true class="bp5-icon bp5-icon-cog"><svg data-icon=cog height=14 role=img viewBox="0 0 16 16" width=14><path d="M15.19 6.39h-1.85c-.11-.37-.27-.71-.45-1.04l1.36-1.36c.31-.31.31-.82 0-1.13l-1.13-1.13a.803.803 0 00-1.13 0l-1.36 1.36c-.33-.17-.67-.33-1.04-.44V.79c0-.44-.36-.8-.8-.8h-1.6c-.44 0-.8.36-.8.8v1.86c-.39.12-.75.28-1.1.47l-1.3-1.3c-.3-.3-.79-.3-1.09 0L1.82 2.91c-.3.3-.3.79 0 1.09l1.3 1.3c-.2.34-.36.7-.48 1.09H.79c-.44 0-.8.36-.8.8v1.6c0 .44.36.8.8.8h1.85c.11.37.27.71.45 1.04l-1.36 1.36c-.31.31-.31.82 0 1.13l1.13 1.13c.31.31.82.31 1.13 0l1.36-1.36c.33.18.67.33 1.04.44v1.86c0 .44.36.8.8.8h1.6c.44 0 .8-.36.8-.8v-1.86c.39-.12.75-.28 1.1-.47l1.3 1.3c.3.3.79.3 1.09 0l1.09-1.09c.3-.3.3-.79 0-1.09l-1.3-1.3c.19-.35.36-.71.48-1.1h1.85c.44 0 .8-.36.8-.8v-1.6a.816.816 0 00-.81-.79zm-7.2 4.6c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z" fill-rule=evenodd></path></svg></span></button><button type=button title=关闭(Esc) class="bp5-button bp5-minimal bp5-small"><span aria-hidden=true class="bp5-icon bp5-icon-cross"><svg data-icon=cross height=18 role=img viewBox="0 0 16 16" width=18><path d="M9.41 8l3.29-3.29c.19-.18.3-.43.3-.71a1.003 1.003 0 00-1.71-.71L8 6.59l-3.29-3.3a1.003 1.003 0 00-1.42 1.42L6.59 8 3.3 11.29c-.19.18-.3.43-.3.71a1.003 1.003 0 001.71.71L8 9.41l3.29 3.29c.18.19.43.3.71.3a1.003 1.003 0 00.71-1.71L9.41 8z" fill-rule=evenodd></path></svg></span></button></div></div><div class=bp5-collapse><div class="bp5-collapse-body sf-hidden" aria-hidden=true></div></div></div><div class=body><p>请输入需要翻译的文本。</p></div></div><div class="arrow sf-hidden"></div></div><div id=web-trs-panel></div></div></div></template></div></div><script data-template-shadow-root>(()=>{document.currentScript.remove();processNode(document);function processNode(node){node.querySelectorAll("template[shadowrootmode]").forEach(element=>{let shadowRoot = element.parentElement.shadowRoot;if (!shadowRoot) {try {shadowRoot=element.parentElement.attachShadow({mode:element.getAttribute("shadowrootmode")});shadowRoot.innerHTML=element.innerHTML;element.remove()} catch (error) {} if (shadowRoot) {processNode(shadowRoot)}}})}})()</script>