<!DOCTYPE html> <html lang=en style><!--
 Page saved with SingleFile 
 url: https://www.jmeiners.com/lc3-vm/ 
 saved date: Thu Jun 27 2024 14:00:43 GMT+0800 (中国标准时间)
--><meta charset=utf-8>
<meta name=viewport content="width=device-width">
<title>Write your Own Virtual Machine</title>
<style>@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.pun{color:#660}}</style>
<style>/*! Color themes for Google Code Prettify | MIT License | github.com/jmblog/color-themes-for-google-code-prettify */@media screen{.str{color:#60ac39}.kwd{color:#b854d4}.com{color:#999580}.typ{color:#6684e1}.lit{color:#b65611}.pun{color:#20201d}}</style>
<style>@font-face{font-family:"Fira Mono";font-style:normal;font-weight:400;src:url(data:font/woff2;base64,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)format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}body{min-width:200px;max-width:850px;margin:3rem auto;padding:0 2rem;font-size:14pt}h1{text-align:center}p{line-height:1.3}li{margin-bottom:0.3rem}img{max-width:100%;display:block;margin-left:auto;margin-right:auto}pre{margin:1rem 0}blockquote{margin:1.5rem 3rem}a{text-decoration:none}a:link,.block-link a:visited{color:#0046b3}a:hover,a:active{text-decoration:underline;color:#4d92ff}a:visited{color:#662e99}code,.block-header{font-size:11pt;font-family:"Fira Mono",Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.block-header,.block-header+pre.prettyprint{background-color:#f9f8f4;border:1px solid #c7c4b4;box-sizing:border-box}.block-header{display:inline-block;position:relative;z-index:6;border-top-left-radius:0.6rem;border-top-right-radius:0.6rem;border-bottom-width:0;padding:0.4rem 0.6rem}.block-title{font-weight:normal}.block-title a{margin-top:-1rem;padding-top:1rem}.block-title,.block-header a:link,.block-header a:visited{color:#262521}.block-header a:hover,.block-header a:active{color:#737372}.code-block pre.prettyprint{padding:0.6rem;white-space:pre-wrap;border-radius:0.6rem}.code-block .block-header+pre.prettyprint{position:relative;z-index:5;margin-top:-1px;border-top-left-radius:0}.block-usages{margin-top:-1rem}.block-usages small{display:inline-block;margin:0.4rem 0.6rem;font-size:11pt;color:#363535}.block-usages a,.block-usages span{padding:0 0.5rem;margin-left:0.1rem}.block-usages a{background-color:#f9f8f4;border:1px solid #c7c6bf;box-sizing:border-box;color:#57554a;border-radius:0.3rem}.block-usages a+*,.block-usages span+*{margin-left:0.2rem}.block-usages a:hover,.block-usages a:active{text-decoration:none;background-color:#f9f9f7;color:#a6a28d}h1+p,h1+p+p{text-align:center}</style>
<style>.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.pun{color:#660}}</style><meta name=referrer content=no-referrer><style>.sf-hidden{display:none!important}</style><link rel=canonical href=https://www.jmeiners.com/lc3-vm/><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<!-- Generated by srcweave. https://github.com/justinmeiners/srcweave -->
<body><h1 id=write-your-own-virtual-machine>Write your Own Virtual Machine</h1>
<p>By: <a href=https://www.jmeiners.com/><strong>Justin Meiners</strong></a> and <a href=https://www.ryanp.me/><strong>Ryan Pendleton</strong></a></p>
<p>View the final code and other resources in the <a href=https://github.com/justinmeiners/lc3-vm>GitHub repo</a>.</p>
<p>In this tutorial, I will teach you how to write your own virtual machine (VM) that can run assembly language programs, such as my friend’s <a href=https://github.com/rpendleton/lc3-2048>2048</a> or my <a href=https://github.com/justinmeiners/lc3-rogue>Roguelike</a>. If you know how to program, but would like to gain a deeper understanding of what is going on inside a computer and better understand how programming languages work, then this project is for you. Writing your own VM may sound a little scary, but I promise that you will find it to be surprisingly simple and enlightening.</p>
<p>The final code is about 250 lines of C (<a href=https://www.jmeiners.com/lc3-vm/src/lc3.c>unix</a>, <a href=https://www.jmeiners.com/lc3-vm/src/lc3-win.c>windows</a>).
All you need to know is how to read basic C or C++ and how to do <a href=https://www.swarthmore.edu/NatSci/echeeve1/Ref/BinaryMath/BinaryMath.html>binary arithmetic</a>.</p>
<ol>
<li><a href=#what-is-a-virtual-machine->What is a virtual machine?</a></li>
<li><a href=#lc-3-architecture>LC-3 architecture</a></li>
<li><a href=#assembly-examples>Assembly examples</a></li>
<li><a href=#executing-programs>Executing programs</a></li>
<li><a href=#implementing-instructions>Implementing instructions</a></li>
<li><a href=#instruction-cheat-sheet>Instruction cheat sheet</a></li>
<li><a href=#trap-routines>Trap routines</a></li>
<li><a href=#trap-routine-cheat-sheet>Trap routine cheat sheet</a></li>
<li><a href=#loading-programs>Loading programs</a></li>
<li><a href=#memory-mapped-registers>Memory mapped registers</a></li>
<li><a href=#platform-specifics>Platform specifics</a></li>
<li><a href=#running-the-vm>Running the VM</a></li>
<li><a href=#alternate-c-technique>Alternate C++ technique</a></li>
<li><a href=#contributions>Contributions</a></li>
</ol>
<blockquote><p><strong>Note:</strong> This tutorial is a <a href=https://en.wikipedia.org/wiki/Literate_programming>literate program</a>.
This means you are reading the source code right now!
Each piece of code from the VM project will be shown and explained thoroughly, so you can be sure nothing is left out.
The final code was created by <a href=https://github.com/justinmeiners/srcweave>“tangling”</a> the blocks of code together.</p></blockquote>
<h2 id=what-is-a-virtual-machine->What is a virtual machine?</h2>
<p>A VM is a program that acts like a computer. It simulates a CPU along with a few other hardware components, allowing it to perform arithmetic, read and write to memory, and interact with I/O devices, just like a physical computer. Most importantly, it can understand a machine language which you can use to program it.</p>
<p>The amount of computer hardware the VM attempts to simulate depends on its purpose. Some VMs are designed to reproduce the behavior of some particular computer, such as video game emulators. Most people don’t have an NES lying around anymore, but we can still play NES games by simulating the NES hardware in a program. These emulators must <a href=http://wiki.nesdev.com/w/index.php/Tricky-to-emulate_games>faithfully recreate</a> every <a href=http://wiki.nesdev.com/w/index.php/Emulator_tests>detail</a> and major hardware component of the original device.</p>
<p>Other VMs don’t act like any real computer and are entirely made up! This is primarily done to make software development easier. Imagine you wanted to create a program that ran on multiple computer architectures. A VM could offer a standard platform which provided portability for all of them. Instead of rewriting a program in different dialects of assembly for each CPU architecture, you would only need to write the small VM program in each assembly language. Each program would then be written only once in the VM’s assembly language.</p>
<p><img src="data:image/gif;base64,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" alt="architecture specific implementation"></p>
<p><img src=data:image/gif;base64,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 alt="vm for each architecture"></p>
<blockquote><p><strong>Note:</strong> A compiler solves a similar problem by compiling a standard <em>high-level language</em> to several CPU architectures. A VM creates one standard <em>CPU architecture</em> which is simulated on various hardware devices. One advantage of a compiler is that it has no runtime overhead while a VM does. Even though compilers do a pretty good job, writing a new one that targets multiple platforms is very difficult, so VMs are still helpful here. In practice, VMs and compilers are mixed at various levels.</p></blockquote>
<p>The <a href=https://en.wikipedia.org/wiki/Java_virtual_machine>Java Virtual Machine (JVM)</a> is a very successful example. The JVM itself is a moderately sized program that is small enough for one programmer to understand. This has made it possible to be written for thousands of devices including phones. Once the JVM is implemented on a new device, any Java, Kotlin, or Clojure program ever written can run on it without modification. The only cost is the overhead of the VM itself and the <a href=https://www.joelonsoftware.com/2002/11/11/the-law-of-leaky-abstractions/>further abstraction</a> from the machine. Most of the time, this is a pretty good tradeoff.</p>
<p>A VM doesn’t have to be large or pervasive to provide a similar benefit. Old <a href=https://fabiensanglard.net/anotherWorld_code_review/>video games</a> often used small VMs to provide simple <a href=https://sf2platinum.wordpress.com/2017/01/20/the-ai-engine/>scripting systems</a>.</p>
<p>VMs are also useful for executing code in a secure or isolated way. One application of this is garbage collection. There <a href=https://www.lua.org/pil/24.2.html>is no trivial way</a> to implement automatic garbage collection on top of C or C++ since a program cannot see its own stack or variables. However, a VM is “outside” the program it is running and can observe all of the <a href=https://en.wikipedia.org/wiki/Tracing_garbage_collection>memory references</a> on the stack.</p>
<p>Another example of this behavior is demonstrated by <a href=https://solidity.readthedocs.io/en/v0.4.24/introduction-to-smart-contracts.html>Ethereum smart contracts</a>. Smart contracts are small programs which are executed by each validating node in the blockchain network. This requires the node operators to run programs on their machines that have been written by complete strangers, without any opportunity to scrutinize them beforehand. To prevent a contract from doing malicious things, they are run inside a <a href=http://ethdocs.org/en/latest/introduction/what-is-ethereum.html#ethereum-virtual-machine>VM</a> that has no access to the file system, network, disc, etc. Ethereum is also a good application of the portability features that result when using a VM. Since Ethereum nodes can be run on many kinds of computers and operating systems, the use of a VM allows smart contracts to be written without any consideration of the many platforms they run on.</p>
<h2 id=lc-3-architecture>LC-3 architecture</h2>
<p>Our VM will simulate the <a href=https://en.wikipedia.org/wiki/Little_Computer_3>LC-3</a>, an educational computer architecture commonly used to teach university students computer architecture and assembly. It has a simplified instruction set <a href=http://ref.x86asm.net/coder64.html>compared to x86</a>, but demonstrates the main ideas used by modern CPUs.</p>
<blockquote><p><strong>Note:</strong> The LC-3 is defined in “Introduction to Computing Systems: From Bits &amp; Gates to C/C++ &amp; Beyond” by Yale N. Patt and Sanjay J. Patel. This tutorial is based on the second edition.</p></blockquote>
<p>To start, we need to simulate the essential hardware components of the machine. Try to understand what each component is, but don’t worry right now if you are unsure of how it fits into the larger picture. Start by creating a C file. Each of the code snippets in this section should be placed in the global scope of this file.</p>
<h3>Memory</h3>
<p>The LC-3 has 65,536 memory locations (the maximum that is addressable by a 16-bit unsigned integer <code>2^16</code>), each of which stores a 16-bit value. This means it can store a total of only 128KB, which is a lot smaller than you may be used to! In our program, this memory will be stored in a simple array:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:memory-storage href=#:memory-storage>Memory Storage</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=com>#define</span><span class=pln> MEMORY_MAX </span><span class=pun>(</span><span class=lit>1</span><span class=pln> </span><span class=pun>&lt;&lt;</span><span class=pln> </span><span class=lit>16</span><span class=pun>)</span><span class=pln>
</span><span class=typ>uint16_t</span><span class=pln> memory</span><span class=pun>[</span><span class=pln>MEMORY_MAX</span><span class=pun>];</span><span class=pln>  </span><span class=com>/* 65536 locations */</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<h3>Registers</h3>
<p>A register is a slot for storing a single value on the CPU. Registers are like the “workbench” of the CPU. For the CPU to work with a piece of data, it has to be in one of the registers. However, since there are just a few registers, only a minimal amount of data can be loaded at any given time. Programs work around this by loading values from memory into registers, calculating values into other registers, and then storing the final results back in memory.</p>
<p>The LC-3 has 10 total registers, each of which is 16 bits. Most of them are general purpose, but a few have designated roles.
- 8 general purpose registers (<code>R0</code>-<code>R7</code>)
- 1 program counter (<code>PC</code>) register
- 1 condition flags (<code>COND</code>) register</p>
<p>The general purpose registers can be used to perform any program calculations. The program counter is an unsigned integer which is the address of the next instruction in memory to execute. The condition flags tell us information about the previous calculation.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:registers href=#:registers>Registers</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>enum</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    R_R0 </span><span class=pun>=</span><span class=pln> </span><span class=lit>0</span><span class=pun>,</span><span class=pln>
    R_R1</span><span class=pun>,</span><span class=pln>
    R_R2</span><span class=pun>,</span><span class=pln>
    R_R3</span><span class=pun>,</span><span class=pln>
    R_R4</span><span class=pun>,</span><span class=pln>
    R_R5</span><span class=pun>,</span><span class=pln>
    R_R6</span><span class=pun>,</span><span class=pln>
    R_R7</span><span class=pun>,</span><span class=pln>
    R_PC</span><span class=pun>,</span><span class=pln> </span><span class=com>/* program counter */</span><span class=pln>
    R_COND</span><span class=pun>,</span><span class=pln>
    R_COUNT
</span><span class=pun>};</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<p>Just like the memory, we will store the registers in an array:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:register-storage href=#:register-storage>Register Storage</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=typ>uint16_t</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_COUNT</span><span class=pun>];</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<h3>Instruction set</h3>
<p>An instruction is a command which tells the CPU to do some fundamental task, such as add two numbers. Instructions have both an <strong>opcode</strong> which indicates the kind of task to perform and a set of <strong>parameters</strong> which provide inputs to the task being performed.</p>
<p>Each <strong>opcode</strong> represents one task that the CPU “knows” how to do. There are just 16 opcodes in LC-3. Everything the computer can calculate is some sequence of these simple instructions. Each instruction is 16 bits long, with the left 4 bits storing the opcode. The rest of the bits are used to store the parameters.</p>
<p>We will discuss, in detail, what each instruction does later. For now, define the following opcodes. Make sure they stay in this order so that they are assigned the proper enum value:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:opcodes href=#:opcodes>Opcodes</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>enum</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    OP_BR </span><span class=pun>=</span><span class=pln> </span><span class=lit>0</span><span class=pun>,</span><span class=pln> </span><span class=com>/* branch */</span><span class=pln>
    OP_ADD</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* add  */</span><span class=pln>
    OP_LD</span><span class=pun>,</span><span class=pln>     </span><span class=com>/* load */</span><span class=pln>
    OP_ST</span><span class=pun>,</span><span class=pln>     </span><span class=com>/* store */</span><span class=pln>
    OP_JSR</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* jump register */</span><span class=pln>
    OP_AND</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* bitwise and */</span><span class=pln>
    OP_LDR</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* load register */</span><span class=pln>
    OP_STR</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* store register */</span><span class=pln>
    OP_RTI</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* unused */</span><span class=pln>
    OP_NOT</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* bitwise not */</span><span class=pln>
    OP_LDI</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* load indirect */</span><span class=pln>
    OP_STI</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* store indirect */</span><span class=pln>
    OP_JMP</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* jump */</span><span class=pln>
    OP_RES</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* reserved (unused) */</span><span class=pln>
    OP_LEA</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* load effective address */</span><span class=pln>
    OP_TRAP    </span><span class=com>/* execute trap */</span><span class=pln>
</span><span class=pun>};</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<blockquote><p><strong>Note:</strong> The Intel x86 architecture has hundreds of instructions, while others such as ARM and LC-3 have very few. Small instruction sets are referred to as <a href=https://en.wikipedia.org/wiki/Reduced_instruction_set_computer>RISCs</a> while larger ones are called <a href=https://en.wikipedia.org/wiki/Complex_instruction_set_computer>CISCs</a>. Larger instruction sets typically do not provide any fundamentally new possibilities, but they <a href=https://cs.stanford.edu/people/eroberts/courses/soco/projects/risc/risccisc/>often make it more convenient</a> to write assembly for. A single instruction in CISC might take the place of several in RISC. However, they tend to be more complex and expensive for engineers to design and manufacture. This and other tradeoffs cause the designs to come <a href=https://cs.stackexchange.com/questions/269/why-would-anyone-want-cisc>in and out of style</a>.</p></blockquote>
<h3>Condition flags</h3>
<p>The <code>R_COND</code> register stores condition flags which provide information about the most recently executed calculation. This allows programs to check logical conditions such as <code>if (x &gt; 0) { ... }</code>.</p>
<p>Each CPU has a variety of condition flags to signal various situations. The LC-3 uses only 3 condition flags which indicate the sign of the previous calculation.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:condition-flags href=#:condition-flags>Condition Flags</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>enum</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    FL_POS </span><span class=pun>=</span><span class=pln> </span><span class=lit>1</span><span class=pln> </span><span class=pun>&lt;&lt;</span><span class=pln> </span><span class=lit>0</span><span class=pun>,</span><span class=pln> </span><span class=com>/* P */</span><span class=pln>
    FL_ZRO </span><span class=pun>=</span><span class=pln> </span><span class=lit>1</span><span class=pln> </span><span class=pun>&lt;&lt;</span><span class=pln> </span><span class=lit>1</span><span class=pun>,</span><span class=pln> </span><span class=com>/* Z */</span><span class=pln>
    FL_NEG </span><span class=pun>=</span><span class=pln> </span><span class=lit>1</span><span class=pln> </span><span class=pun>&lt;&lt;</span><span class=pln> </span><span class=lit>2</span><span class=pun>,</span><span class=pln> </span><span class=com>/* N */</span><span class=pln>
</span><span class=pun>};</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<blockquote><p><strong>Note:</strong> (The <code>&lt;&lt;</code> symbol is called the <a href=https://msdn.microsoft.com/en-us/library/336xbhcz.aspx>left bitshift operator</a>. <code>(n &lt;&lt; k)</code> shifts the bits of <code>n</code> to the left <code>k</code> places. Thus <code>1 &lt;&lt; 2</code> will equal <code>4</code>. Read that link if you are not familiar. It will be important.)</p></blockquote>
<p>We are finished setting up the hardware components of our VM! After adding standard includes (see reference), your file should look something like this:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:lc3.c href=#:lc3.c>/lc3.c</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><em class="block-link nocode"><a href=#:includes>@{Includes}</a></em><span class=pln>

</span><em class="block-link nocode"><a href=#:registers>@{Registers}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:condition-flags>@{Condition Flags}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:opcodes>@{Opcodes}</a></em>
</code></pre>
</div>
<h2 id=assembly-examples>Assembly examples</h2>
<p>Now let’s look at an LC-3 assembly program to get an idea of what the VM actually runs. You don’t need to know how to program assembly or understand everything that is going on. Just try to get a general idea of what is going on. Here is a simple “Hello World”:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:hello-world-assembly href=#:hello-world-assembly>Hello World Assembly</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>.</span><span class=pln>ORIG x3000                        </span><span class=pun>;</span><span class=pln> </span><span class=kwd>this</span><span class=pln> </span><span class=kwd>is</span><span class=pln> the address </span><span class=kwd>in</span><span class=pln> memory </span><span class=kwd>where</span><span class=pln> the program will be loaded
LEA R0</span><span class=pun>,</span><span class=pln> HELLO_STR                  </span><span class=pun>;</span><span class=pln> load the address of the HELLO_STR </span><span class=kwd>string</span><span class=pln> </span><span class=kwd>into</span><span class=pln> R0
</span><span class=typ>PUTs</span><span class=pln>                               </span><span class=pun>;</span><span class=pln> output the </span><span class=kwd>string</span><span class=pln> pointed to </span><span class=kwd>by</span><span class=pln> R0 to the console
HALT                               </span><span class=pun>;</span><span class=pln> halt the program
HELLO_STR </span><span class=pun>.</span><span class=pln>STRINGZ </span><span class=str>"Hello World!"</span><span class=pln>  </span><span class=pun>;</span><span class=pln> store </span><span class=kwd>this</span><span class=pln> </span><span class=kwd>string</span><span class=pln> here </span><span class=kwd>in</span><span class=pln> the program
</span><span class=pun>.</span><span class=kwd>END</span><span class=pln>                               </span><span class=pun>;</span><span class=pln> mark the </span><span class=kwd>end</span><span class=pln> of the file</span></code></pre>
</div>
<p>Just like in C, the program starts at the top and executes one statement at a time. However, unlike C, there are no nested scopes <code>{}</code> or control structures such as <code>if</code> or <code>while</code>; just a flat list of statements. This makes it much easier to execute.</p>
<p>Notice that some of the statements have names which match the opcodes we defined earlier. Previously, we learned that every instruction was 16 bits, but each line looks like it is a different number of characters. How is this inconsistency possible?</p>
<p>This is because the code we are reading is written in <strong>assembly</strong> which is a human-readable and writable form, encoded in plain text. A tool called an <strong>assembler</strong> is used to transform each line of text into a 16-bit binary instruction the VM can understand. This binary form, which is essentially an array of 16-bit instructions, is called <strong>machine code</strong> and is what the VM actually runs.</p>
<p><img src="data:image/gif;base64,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" alt="assembler diagram"></p>
<blockquote><p><strong>Note:</strong> Although a compiler and an assembler play a similar role in development, they are not the same. An assembler simply encodes what the programmer has written in text into binary, replacing symbols with their binary representation and packing them into instructions.</p></blockquote>
<p>The commands <code>.ORIG</code> and <code>.STRINGZ</code> look like instructions but they aren’t. They are assembler directives which generate a piece of code or data (like macros). For example, the <code>.STRINGZ</code> inserts a string of characters into the program binary at the location it is written.</p>
<p>Loops and conditions are done with a <a href=https://en.wikipedia.org/wiki/Goto>goto</a>-like instruction. Here is another example which counts to 10.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:loop-assembly href=#:loop-assembly>Loop Assembly</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pln>AND R0</span><span class=pun>,</span><span class=pln> R0</span><span class=pun>,</span><span class=pln> </span><span class=lit>0</span><span class=pln>                      </span><span class=pun>;</span><span class=pln> clear R0
LOOP                               </span><span class=pun>;</span><span class=pln> label at the top of </span><span class=kwd>our</span><span class=pln> loop
ADD R0</span><span class=pun>,</span><span class=pln> R0</span><span class=pun>,</span><span class=pln> </span><span class=lit>1</span><span class=pln>                      </span><span class=pun>;</span><span class=pln> add </span><span class=lit>1</span><span class=pln> to R0 </span><span class=kwd>and</span><span class=pln> store back </span><span class=kwd>in</span><span class=pln> R0
ADD R1</span><span class=pun>,</span><span class=pln> R0</span><span class=pun>,</span><span class=pln> </span><span class=pun>-</span><span class=lit>10</span><span class=pln>                    </span><span class=pun>;</span><span class=pln> subtract </span><span class=lit>10</span><span class=pln> </span><span class=kwd>from</span><span class=pln> R0 </span><span class=kwd>and</span><span class=pln> store back </span><span class=kwd>in</span><span class=pln> R1
</span><span class=typ>BRn</span><span class=pln> LOOP                           </span><span class=pun>;</span><span class=pln> go back to LOOP </span><span class=kwd>if</span><span class=pln> the result was negative
</span><span class=pun>...</span><span class=pln> </span><span class=pun>;</span><span class=pln> R0 </span><span class=kwd>is</span><span class=pln> now </span><span class=lit>10</span><span class=pun>!</span></code></pre>
</div>
<blockquote><p><strong>Note:</strong> Learning to write assembly is not necessary for this tutorial. However, if you are interested, you can write and assemble your own LC-3 programs using the <a href=http://highered.mheducation.com/sites/0072467509/student_view0/lc-3_simulator.html>LC-3 Tools</a>.</p></blockquote>
<h2 id=executing-programs>Executing programs</h2>
<p>Once again, the previous examples are just to give you an idea of what the VM does. To write a VM, you don’t need to be fluent in assembly. As long as you follow the proper procedure for reading and executing instructions, <em>any</em> LC-3 program will run correctly, no matter how complicated it is. In theory, it could even run a web browser or an operating system like Linux!</p>
<p>If you think about this property deeply, it is a philosophically remarkable idea. The programs themselves can do all kinds of intelligent things that we never anticipated and may not be able to understand, but at the same time, everything they can do is limited to the simple code we will write! We simultaneously know everything and nothing about how each program works. Turing observed this marvelous idea:</p>
<blockquote><p>“The view that machines cannot give rise to surprises is due, I believe, to a fallacy to which philosophers and mathematicians are particularly subject. This is the assumption that as soon as a fact is presented to a mind all consequences of that fact spring into the mind simultaneously with it. It is a very useful assumption under many circumstances, but one too easily forgets that it is false.” — <a href=https://academic.oup.com/mind/article-pdf/LIX/236/433/9866119/433.pdf>Alan M. Turing</a></p></blockquote>
<h3>Procedure</h3>
<p>Here is the procedure we need to write:</p>
<ol>
<li>Load one instruction from memory at the address of the <code>PC</code> register.</li>
<li>Increment the <code>PC</code> register.</li>
<li>Look at the <em>opcode</em> to determine which type of instruction it should perform.</li>
<li>Perform the instruction using the parameters in the instruction.</li>
<li>Go back to step 1.</li>
</ol>
<p>You may be wondering, “if the loop keeps incrementing the <code>PC</code>, and we don’t have <code>if</code> or <code>while</code>, won’t it quickly run out of instructions?” No. As we mentioned before, some goto-like instructions change the execution flow by jumping the <code>PC</code> around.</p>
<p>Let’s start outlining this process in the main loop:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:main-loop href=#:main-loop>Main Loop</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>int</span><span class=pln> main</span><span class=pun>(</span><span class=kwd>int</span><span class=pln> argc</span><span class=pun>,</span><span class=pln> </span><span class=kwd>const</span><span class=pln> </span><span class=kwd>char</span><span class=pun>*</span><span class=pln> argv</span><span class=pun>[])</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><em class="block-link nocode"><a href=#:load-arguments>@{Load Arguments}</a></em><span class=pln>
    </span><em class="block-link nocode"><a href=#:setup>@{Setup}</a></em><span class=pln>

    </span><span class=com>/* since exactly one condition flag should be set at any given time, set the Z flag */</span><span class=pln>
    reg</span><span class=pun>[</span><span class=pln>R_COND</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> FL_ZRO</span><span class=pun>;</span><span class=pln>

    </span><span class=com>/* set the PC to starting position */</span><span class=pln>
    </span><span class=com>/* 0x3000 is the default */</span><span class=pln>
    </span><span class=kwd>enum</span><span class=pln> </span><span class=pun>{</span><span class=pln> PC_START </span><span class=pun>=</span><span class=pln> </span><span class=lit>0x3000</span><span class=pln> </span><span class=pun>};</span><span class=pln>
    reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> PC_START</span><span class=pun>;</span><span class=pln>

    </span><span class=kwd>int</span><span class=pln> running </span><span class=pun>=</span><span class=pln> </span><span class=lit>1</span><span class=pun>;</span><span class=pln>
    </span><span class=kwd>while</span><span class=pln> </span><span class=pun>(</span><span class=pln>running</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=com>/* FETCH */</span><span class=pln>
        </span><span class=typ>uint16_t</span><span class=pln> instr </span><span class=pun>=</span><span class=pln> mem_read</span><span class=pun>(</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]++);</span><span class=pln>
        </span><span class=typ>uint16_t</span><span class=pln> op </span><span class=pun>=</span><span class=pln> instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>12</span><span class=pun>;</span><span class=pln>

        </span><span class=kwd>switch</span><span class=pln> </span><span class=pun>(</span><span class=pln>op</span><span class=pun>)</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_ADD</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:add>@{ADD}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_AND</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:and>@{AND}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_NOT</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:not>@{NOT}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_BR</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:br>@{BR}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_JMP</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:jmp>@{JMP}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_JSR</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:jsr>@{JSR}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_LD</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:ld>@{LD}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_LDI</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:ldi>@{LDI}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_LDR</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:ldr>@{LDR}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_LEA</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:lea>@{LEA}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_ST</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:st>@{ST}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_STI</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:sti>@{STI}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_STR</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:str>@{STR}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_TRAP</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:trap>@{TRAP}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_RES</span><span class=pun>:</span><span class=pln>
            </span><span class=kwd>case</span><span class=pln> OP_RTI</span><span class=pun>:</span><span class=pln>
            </span><span class=kwd>default</span><span class=pun>:</span><span class=pln>
                </span><em class="block-link nocode"><a href=#:bad-opcode>@{BAD OPCODE}</a></em><span class=pln>
                </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><em class="block-link nocode"><a href=#:shutdown>@{Shutdown}</a></em><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> </small></p></div>
<p>While we are at the main loop let’s handle command line input to make our program usable.
We expect one or more paths to VM images and present a usage string if none are given.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:load-arguments href=#:load-arguments>Load Arguments</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>argc </span><span class=pun>&lt;</span><span class=pln> </span><span class=lit>2</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=com>/* show usage string */</span><span class=pln>
    printf</span><span class=pun>(</span><span class=str>"lc3 [image-file1] ...\n"</span><span class=pun>);</span><span class=pln>
    </span><span class=kwd>exit</span><span class=pun>(</span><span class=lit>2</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span><span class=pln>

</span><span class=kwd>for</span><span class=pln> </span><span class=pun>(</span><span class=kwd>int</span><span class=pln> j </span><span class=pun>=</span><span class=pln> </span><span class=lit>1</span><span class=pun>;</span><span class=pln> j </span><span class=pun>&lt;</span><span class=pln> argc</span><span class=pun>;</span><span class=pln> </span><span class=pun>++</span><span class=pln>j</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(!</span><span class=pln>read_image</span><span class=pun>(</span><span class=pln>argv</span><span class=pun>[</span><span class=pln>j</span><span class=pun>]))</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        printf</span><span class=pun>(</span><span class=str>"failed to load image: %s\n"</span><span class=pun>,</span><span class=pln> argv</span><span class=pun>[</span><span class=pln>j</span><span class=pun>]);</span><span class=pln>
        </span><span class=kwd>exit</span><span class=pun>(</span><span class=lit>1</span><span class=pun>);</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> <span title=/lc3-alt.cpp>2</span> <span title=/lc3-alt-win.cpp>3</span> </small></p></div>
<h2 id=implementing-instructions>Implementing instructions</h2>
<p>Your task now is to fill in each opcode case with a correct implementation. This is easier than it sounds. A detailed specification for each instruction is included in the <a href=https://www.jmeiners.com/lc3-vm/supplies/lc3-isa.pdf>project documents</a>. The specificiation for each translates pretty easily to several lines of codes. I will demonstrate how to implement two of them here. The code for the rest can be found in the next section.</p>
<h3>ADD</h3>
<p>The <code>ADD</code> instruction takes two numbers, adds them together, and stores the result in a register. Its specification is found on page 526. Each <code>ADD</code> instruction looks like the following:</p>
<p><img src="data:image/gif;base64,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" alt="Add Encoding"></p>
<p>The encoding shows two rows because there are two different “modes” for this instruction. Before I explain modes, let’s try to find the similarities between them. In both rows, we can see that we start with 4 bits, <code>0001</code>. This is the opcode value for <code>OP_ADD</code>. The next 3 bits are marked <code>DR</code>. This stands for destination register. The destination register is where the added sum will be stored. The next 3 bits are <code>SR1</code>. This is the register containing the first number to add.</p>
<p>So we know where we want to store the result and we know the first number to add. The last bit of information we need is the second number to add. At this point, the two rows start to look different. Notice that on the top row the 5th bit is a <code>0</code> and in the second row it is <code>1</code>. This bit indicates whether it is <em>immediate mode</em> or <em>register mode</em>. In <em>register mode</em>, the second number is stored in a register just like the first. This is marked <code>SR2</code> and is contained in bits 2-0. Bits 3 and 4 are unused. In assembly this would be written as:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:add-register-assembly href=#:add-register-assembly>Add Register Assembly</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pln>ADD R2 R0 R1 </span><span class=pun>;</span><span class=pln> add the contents of R0 to R1 </span><span class=kwd>and</span><span class=pln> store </span><span class=kwd>in</span><span class=pln> R2</span><span class=pun>.</span></code></pre>
</div>
<p>Immediate mode is a convenience which reduces the length of a typical program.
Instead of adding two values stored in separate registers, the second value is embedded in the instruction itself, marked
<code>imm5</code> in the diagram.
This removes the need to write instructions to load the value from memory.
The tradeoff is that the instruction only has room for a small number, up to <code>2^5=32</code> (unsigned) to be exact,
making immediate mode primarily useful for incrementing and decrementing. In assembly, it could be written as:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:add-immediate-assembly href=#:add-immediate-assembly>Add Immediate Assembly</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pln>ADD R0 R0 </span><span class=lit>1</span><span class=pln> </span><span class=pun>;</span><span class=pln> add </span><span class=lit>1</span><span class=pln> to R0 </span><span class=kwd>and</span><span class=pln> store back </span><span class=kwd>in</span><span class=pln> R0</span></code></pre>
</div>
<p>Here is a summary from the specification:</p>
<blockquote><p>If bit [5] is 0, the second source operand is obtained from SR2. If bit [5] is 1, the second source operand is obtained by sign-extending the imm5 field to 16 bits. In both cases, the second source operand is added to the contents of SR1 and the result stored in DR. (Pg. 526)</p></blockquote>
<p>That sounds just like the behaviour we discussed, but what is “sign-extending”? The immediate mode value has only 5 bits, but it needs to be added to a 16-bit number. To do the addition, those 5 bits need to be extended to 16 to match the other number. For positive numbers, we can simply fill in 0’s for the additional bits. For negative numbers, this causes a problem. For example, -1 in 5 bits is <code>1 1111</code>. If we just extended it with 0’s, this is <code>0000 0000 0001 1111</code> which is equal to 31. Sign extension corrects this problem by filling in 0’s for positive numbers and 1’s for negative numbers, so that original values are preserved.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:sign-extend href=#:sign-extend>Sign Extend</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=typ>uint16_t</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=typ>uint16_t</span><span class=pln> x</span><span class=pun>,</span><span class=pln> </span><span class=kwd>int</span><span class=pln> bit_count</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>((</span><span class=pln>x </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=pun>(</span><span class=pln>bit_count </span><span class=pun>-</span><span class=pln> </span><span class=lit>1</span><span class=pun>))</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>1</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln>
        x </span><span class=pun>|=</span><span class=pln> </span><span class=pun>(</span><span class=lit>0xFFFF</span><span class=pln> </span><span class=pun>&lt;&lt;</span><span class=pln> bit_count</span><span class=pun>);</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>return</span><span class=pln> x</span><span class=pun>;</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<blockquote><p><strong>Note:</strong> If you are interested in exactly how negative numbers can be represented in binary, you can read about <a href=https://en.wikipedia.org/wiki/Two%27s_complement>Two’s Complement</a>. However, this is not essential. You can just copy the code above and use it whenever the specification says to sign extend numbers.</p></blockquote>
<p>There is one last sentence in the specification:</p>
<blockquote><p>The condition codes are set, based on whether the result is negative, zero, or positive. (Pg. 526)</p></blockquote>
<p>Earlier we defined a condition flags enum, and now it’s time to use them. <em>Any time</em> a value is written to a register, we need to update the flags to indicate its sign. We will write a function so that this can be reused:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:update-flags href=#:update-flags>Update Flags</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>void</span><span class=pln> update_flags</span><span class=pun>(</span><span class=typ>uint16_t</span><span class=pln> r</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>r</span><span class=pun>]</span><span class=pln> </span><span class=pun>==</span><span class=pln> </span><span class=lit>0</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>R_COND</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> FL_ZRO</span><span class=pun>;</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>else</span><span class=pln> </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>r</span><span class=pun>]</span><span class=pln> </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>15</span><span class=pun>)</span><span class=pln> </span><span class=com>/* a 1 in the left-most bit indicates negative */</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>R_COND</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> FL_NEG</span><span class=pun>;</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>else</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>R_COND</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> FL_POS</span><span class=pun>;</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<p>Now we are ready to write the code for the <code>ADD</code> case:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:add href=#:add>ADD</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=com>/* destination register (DR) */</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=com>/* first operand (SR1) */</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r1 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>6</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=com>/* whether we are in immediate mode */</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> imm_flag </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>5</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1</span><span class=pun>;</span><span class=pln>

    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>imm_flag</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=typ>uint16_t</span><span class=pln> imm5 </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1F</span><span class=pun>,</span><span class=pln> </span><span class=lit>5</span><span class=pun>);</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> imm5</span><span class=pun>;</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>else</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=typ>uint16_t</span><span class=pln> r2 </span><span class=pun>=</span><span class=pln> instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r2</span><span class=pun>];</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>

    update_flags</span><span class=pun>(</span><span class=pln>r0</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<p>This section contained a lot of information, so let’s summarize.
- <code>ADD</code> takes two values and stores them in a register.
- In register mode, the second value to add is found in a register.
- In immediate mode, the second value is embedded in the right-most 5 bits of the instruction.
- Values which are shorter than 16 bits need to be sign extended.
- Any time an instruction modifies a register, the condition flags need to be updated.</p>
<p>You may be feeling overwhelmed about writing 15 more instructions. However, all of what you learned here will be reused. Most of the instructions use some combination of sign extension, different modes, and updating flags.</p>
<h3>LDI</h3>
<p><code>LDI</code> stands for “load indirect.” This instruction is used to load a value from a location in memory into a register. The specification is found on page 532.</p>
<p>Here is what the binary layout looks like:</p>
<p><img src="data:image/gif;base64,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" alt="LDI Encoding"></p>
<p>In contrast to <code>ADD</code>, there are no modes and fewer parameters. This time, the opcode is <code>1010</code> which corresponds with the <code>OP_LDI</code> enum value. Just like <code>ADD</code>, it contains a 3-bit <code>DR</code> (the destination register) for storing the loaded value. The remaining bits are labeled <code>PCoffset9</code>. This is an immediate value embedded in the instruction (similar to <code>imm5</code>). Since this instruction loads from memory, we can guess that this number is some kind of address which tells us where to load from. The specification provides more detail:</p>
<blockquote><p>An address is computed by sign-extending bits <code>[8:0]</code> to 16 bits and adding this value to the incremented <code>PC</code>. What is stored in memory at this address is the address of the data to be loaded into <code>DR</code>. (Pg. 532)</p></blockquote>
<p>Just like before, we need to sign extend this 9-bit value, but this time add it to the current <code>PC</code>. (If you look back at the execution loop, the <code>PC</code> was incremented right after this instruction was loaded.) The resulting sum is an address to a location in memory, and that address <em>contains, yet another</em> value which is the address of the value to load.</p>
<p>This may seem like a roundabout way to read from memory, but it is indispensable. The <code>LD</code> instruction is limited to address offsets that are 9 bits, whereas the memory requires 16 bits to address. <code>LDI</code> is useful for loading values that are stored in locations far away from the current PC, but to use it, the address of the final location needs to be stored in a neighborhood nearby. You can think of it like having a local variable in C which is a pointer to some data:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:c-ldi-sample href=#:c-ldi-sample>C LDI Sample</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=com>// the value of far_data is an address</span><span class=pln>
</span><span class=com>// of course far_data itself (the location in memory containing the address) has an address</span><span class=pln>
</span><span class=kwd>char</span><span class=pun>*</span><span class=pln> far_data </span><span class=pun>=</span><span class=pln> </span><span class=str>"apple"</span><span class=pun>;</span><span class=pln>

</span><span class=com>// In memory it may be layed out like this:</span><span class=pln>

</span><span class=com>// Address Label      Value</span><span class=pln>
</span><span class=com>// 0x123:  far_data = 0x456</span><span class=pln>
</span><span class=com>// ...</span><span class=pln>
</span><span class=com>// 0x456:  string   = 'a'</span><span class=pln>

</span><span class=com>// if PC was at 0x100</span><span class=pln>
</span><span class=com>// LDI R0 0x023</span><span class=pln>
</span><span class=com>// would load 'a' into R0</span></code></pre>
</div>
<p>Same as before, the flags need to be updated after putting the value into <code>DR</code>:</p>
<blockquote><p>The condition codes are set based on whether the value loaded is negative, zero, or positive. (Pg. 532)</p></blockquote>
<p>Here is the code for this case: (<code>mem_read</code> will be discussed in a later section.)</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:ldi href=#:ldi>LDI</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=com>/* destination register (DR) */</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=com>/* PCoffset 9*/</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> pc_offset </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1FF</span><span class=pun>,</span><span class=pln> </span><span class=lit>9</span><span class=pun>);</span><span class=pln>
    </span><span class=com>/* add pc_offset to the current PC, look at that memory location to get the final address */</span><span class=pln>
    reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> mem_read</span><span class=pun>(</span><span class=pln>mem_read</span><span class=pun>(</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> pc_offset</span><span class=pun>));</span><span class=pln>
    update_flags</span><span class=pun>(</span><span class=pln>r0</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<p>As I said, this instruction shared a lot of the code and knowledge learned from <code>ADD</code>. You will find this is the case with the remaining instructions.</p>
<p>You now need to go back and implement the rest of the switch cases for the instructions. Follow <a href=https://www.jmeiners.com/lc3-vm/supplies/lc3-isa.pdf>the specification</a> and use the code listed here to complete the others. The code for all instructions is listed at the end of the tutorial. Two of the opcodes specified before will not be used, they are <code>OP_RTI</code> and <code>OP_RES</code>. You can ignore these cases or throw an error if they are executed. After you are done, the bulk of your VM will be completed!</p>
<h2 id=instruction-cheat-sheet>Instruction cheat sheet</h2>
<p>This section contains the full implementations of the remaining instructions if you get stuck.</p>
<h3>RTI &amp; RES</h3>
<p>(these are unused)</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:bad-opcode href=#:bad-opcode>BAD OPCODE</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pln>abort</span><span class=pun>();</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Bitwise and</h3>
<p><a href=https://en.wikipedia.org/wiki/Bitwise_operation#AND>More info</a>.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:and href=#:and>AND</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r1 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>6</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> imm_flag </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>5</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1</span><span class=pun>;</span><span class=pln>

    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>imm_flag</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=typ>uint16_t</span><span class=pln> imm5 </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1F</span><span class=pun>,</span><span class=pln> </span><span class=lit>5</span><span class=pun>);</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> imm5</span><span class=pun>;</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>else</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=typ>uint16_t</span><span class=pln> r2 </span><span class=pun>=</span><span class=pln> instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r2</span><span class=pun>];</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    update_flags</span><span class=pun>(</span><span class=pln>r0</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Bitwise not</h3>
<p><a href=https://en.wikipedia.org/wiki/Bitwise_operation#NOT>More info</a>.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:not href=#:not>NOT</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r1 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>6</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>

    reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> </span><span class=pun>~</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>];</span><span class=pln>
    update_flags</span><span class=pun>(</span><span class=pln>r0</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Branch</h3>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:br href=#:br>BR</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> pc_offset </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1FF</span><span class=pun>,</span><span class=pln> </span><span class=lit>9</span><span class=pun>);</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> cond_flag </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>cond_flag </span><span class=pun>&amp;</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_COND</span><span class=pun>])</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>+=</span><span class=pln> pc_offset</span><span class=pun>;</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Jump</h3>
<p><code>RET</code> is listed as a separate instruction in the specification, since it is a different keyword in assembly. However, it is actually a special case of <code>JMP</code>. <code>RET</code> happens whenever <code>R1</code> is 7.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:jmp href=#:jmp>JMP</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=com>/* Also handles RET */</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r1 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>6</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>];</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Jump register</h3>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:jsr href=#:jsr>JSR</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> long_flag </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>11</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>1</span><span class=pun>;</span><span class=pln>
    reg</span><span class=pun>[</span><span class=pln>R_R7</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>];</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>long_flag</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=typ>uint16_t</span><span class=pln> long_pc_offset </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7FF</span><span class=pun>,</span><span class=pln> </span><span class=lit>11</span><span class=pun>);</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>+=</span><span class=pln> long_pc_offset</span><span class=pun>;</span><span class=pln>  </span><span class=com>/* JSR */</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>else</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=typ>uint16_t</span><span class=pln> r1 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>6</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>];</span><span class=pln> </span><span class=com>/* JSRR */</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Load</h3>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:ld href=#:ld>LD</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> pc_offset </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1FF</span><span class=pun>,</span><span class=pln> </span><span class=lit>9</span><span class=pun>);</span><span class=pln>
    reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> mem_read</span><span class=pun>(</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> pc_offset</span><span class=pun>);</span><span class=pln>
    update_flags</span><span class=pun>(</span><span class=pln>r0</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Load register</h3>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:ldr href=#:ldr>LDR</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r1 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>6</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> offset </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x3F</span><span class=pun>,</span><span class=pln> </span><span class=lit>6</span><span class=pun>);</span><span class=pln>
    reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> mem_read</span><span class=pun>(</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> offset</span><span class=pun>);</span><span class=pln>
    update_flags</span><span class=pun>(</span><span class=pln>r0</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Load effective address</h3>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:lea href=#:lea>LEA</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> pc_offset </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1FF</span><span class=pun>,</span><span class=pln> </span><span class=lit>9</span><span class=pun>);</span><span class=pln>
    reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> pc_offset</span><span class=pun>;</span><span class=pln>
    update_flags</span><span class=pun>(</span><span class=pln>r0</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Store</h3>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:st href=#:st>ST</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> pc_offset </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1FF</span><span class=pun>,</span><span class=pln> </span><span class=lit>9</span><span class=pun>);</span><span class=pln>
    mem_write</span><span class=pun>(</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> pc_offset</span><span class=pun>,</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Store indirect</h3>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:sti href=#:sti>STI</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> pc_offset </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1FF</span><span class=pun>,</span><span class=pln> </span><span class=lit>9</span><span class=pun>);</span><span class=pln>
    mem_write</span><span class=pun>(</span><span class=pln>mem_read</span><span class=pun>(</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> pc_offset</span><span class=pun>),</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h3>Store register</h3>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:str href=#:str>STR</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r1 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>6</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> offset </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x3F</span><span class=pun>,</span><span class=pln> </span><span class=lit>6</span><span class=pun>);</span><span class=pln>
    mem_write</span><span class=pun>(</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> offset</span><span class=pun>,</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> </small></p></div>
<h2 id=trap-routines>Trap routines</h2>
<p>The LC-3 provides a few predefined routines for performing common tasks and interacting with I/O devices. For example, there are routines for getting input from the keyboard and for displaying strings to the console. These are called <em>trap routines</em> which you can think of as the operating system or API for the LC-3. Each trap routine is assigned a <em>trap code</em> which identifies it (similar to an opcode). To execute one, the <code>TRAP</code> instruction is called with the trap code of the desired routine.</p>
<p><img src=data:image/gif;base64,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 alt="Trap Encoding"></p>
<p>Define an enum for each trap code:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:trap-codes href=#:trap-codes>TRAP Codes</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>enum</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    TRAP_GETC </span><span class=pun>=</span><span class=pln> </span><span class=lit>0x20</span><span class=pun>,</span><span class=pln>  </span><span class=com>/* get character from keyboard, not echoed onto the terminal */</span><span class=pln>
    TRAP_OUT </span><span class=pun>=</span><span class=pln> </span><span class=lit>0x21</span><span class=pun>,</span><span class=pln>   </span><span class=com>/* output a character */</span><span class=pln>
    TRAP_PUTS </span><span class=pun>=</span><span class=pln> </span><span class=lit>0x22</span><span class=pun>,</span><span class=pln>  </span><span class=com>/* output a word string */</span><span class=pln>
    TRAP_IN </span><span class=pun>=</span><span class=pln> </span><span class=lit>0x23</span><span class=pun>,</span><span class=pln>    </span><span class=com>/* get character from keyboard, echoed onto the terminal */</span><span class=pln>
    TRAP_PUTSP </span><span class=pun>=</span><span class=pln> </span><span class=lit>0x24</span><span class=pun>,</span><span class=pln> </span><span class=com>/* output a byte string */</span><span class=pln>
    TRAP_HALT </span><span class=pun>=</span><span class=pln> </span><span class=lit>0x25</span><span class=pln>   </span><span class=com>/* halt the program */</span><span class=pln>
</span><span class=pun>};</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<p>You may be wondering why the trap codes are not included in the instructions.
This is because they do not actually introduce any new functionality to the LC-3, they just provide a convenient way to perform a task (similar to OS system calls).
In the official LC-3 simulator, trap routines are <a href=https://www.jmeiners.com/lc3-vm/supplies/os.asm>written in assembly</a>.
When a trap code is called, the <code>PC</code> is moved to that code’s address.
The CPU executes the procedure’s instructions, and when it is complete, the PC is reset to the location following the initial call.</p>
<blockquote><p><strong>Note:</strong> This is why programs start at address <code>0x3000</code> instead of <code>0x0</code>. The lower addresses are left empty to leave space for the trap routine code.</p></blockquote>
<p>There is no specification for <em>how</em> trap routines must be implemented, only what they are supposed to do.
In our VM, we are going to do things slightly differently by writing them in C.
When a trap code is invoked, a C function will be called. When it is completed, execution will return to the instructions.
(If you are curious about trap codes in assembly, see <a href=https://github.com/rpendleton/lc3sim-c>Ryan’s implementation</a>.)</p>
<p>Even though the trap routines can be written in assembly and this is what a physical LC-3 computer would do, it isn’t the best fit for a VM. Instead of writing our own primitive I/O routines, we can take advantage of the ones available on our OS. This will make the VM run better on our computers, simplify the code, and provide a higher level of abstraction for portability.</p>
<blockquote><p><strong>Note:</strong> Getting input from the keyboard is one specific example of this. The assembly version uses a loop to continuously check the keyboard for input. This consumes a lot of CPU time for nothing! Using a proper OS input function allows the program to sleep until input is received.</p></blockquote>
<p>In the switch case for the <code>TRAP</code> opcode, add another switch:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:trap href=#:trap>TRAP</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pln>reg</span><span class=pun>[</span><span class=pln>R_R7</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>];</span><span class=pln>

</span><span class=kwd>switch</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0xFF</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=kwd>case</span><span class=pln> TRAP_GETC</span><span class=pun>:</span><span class=pln>
        </span><em class="block-link nocode"><a href=#:trap-getc>@{TRAP GETC}</a></em><span class=pln>
        </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
    </span><span class=kwd>case</span><span class=pln> TRAP_OUT</span><span class=pun>:</span><span class=pln>
        </span><em class="block-link nocode"><a href=#:trap-out>@{TRAP OUT}</a></em><span class=pln>
        </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
    </span><span class=kwd>case</span><span class=pln> TRAP_PUTS</span><span class=pun>:</span><span class=pln>
        </span><em class="block-link nocode"><a href=#:trap-puts>@{TRAP PUTS}</a></em><span class=pln>
        </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
    </span><span class=kwd>case</span><span class=pln> TRAP_IN</span><span class=pun>:</span><span class=pln>
        </span><em class="block-link nocode"><a href=#:trap-in>@{TRAP IN}</a></em><span class=pln>
        </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
    </span><span class=kwd>case</span><span class=pln> TRAP_PUTSP</span><span class=pun>:</span><span class=pln>
        </span><em class="block-link nocode"><a href=#:trap-putsp>@{TRAP PUTSP}</a></em><span class=pln>
        </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
    </span><span class=kwd>case</span><span class=pln> TRAP_HALT</span><span class=pun>:</span><span class=pln>
        </span><em class="block-link nocode"><a href=#:trap-halt>@{TRAP HALT}</a></em><span class=pln>
        </span><span class=kwd>break</span><span class=pun>;</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> <a href=#:instruction-c- title="Instruction C++">2</a> </small></p></div>
<p>As with instructions, I will show you how to implement a single trap routine and leave the rest to you.</p>
<h3>PUTS</h3>
<p>The <code>PUTS</code> trap code is used to output a null-terminated string (similar to <code>printf</code> in C). The specification is found on page 543.</p>
<p>To display a string, we must give the trap routine a string to display. This is done by storing the address of the first character in <code>R0</code> before beginning the trap.</p>
<p>The specification says:</p>
<blockquote><p>Write a string of ASCII characters to the console display. The characters are contained
in consecutive memory locations, one character per memory location, starting with the address specified in <code>R0</code>. Writing terminates with the occurrence of <code>x0000</code> in a memory location. (Pg. 543)</p></blockquote>
<p>Notice that unlike C strings, characters are <em>not stored</em> in a single byte, but in a <em>single memory location</em>. Memory locations in LC-3 are 16 bits, so each character in the string is 16 bits wide. To display this with a C function, we will need to convert each value to a char and output them individually.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:trap-puts href=#:trap-puts>TRAP PUTS</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=com>/* one char per word */</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pun>*</span><span class=pln> c </span><span class=pun>=</span><span class=pln> memory </span><span class=pun>+</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_R0</span><span class=pun>];</span><span class=pln>
    </span><span class=kwd>while</span><span class=pln> </span><span class=pun>(*</span><span class=pln>c</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        putc</span><span class=pun>((</span><span class=kwd>char</span><span class=pun>)*</span><span class=pln>c</span><span class=pun>,</span><span class=pln> stdout</span><span class=pun>);</span><span class=pln>
        </span><span class=pun>++</span><span class=pln>c</span><span class=pun>;</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    fflush</span><span class=pun>(</span><span class=pln>stdout</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:trap title=TRAP>1</a> </small></p></div>
<p>That’s all for this routine. The trap routines are pretty straightforward if you are familiar with C. Go back to the specification and implement the others now. As with the instructions, the full code can be found at the end of the tutorial.</p>
<h2 id=trap-routine-cheat-sheet>Trap routine cheat sheet</h2>
<p>This section contains the full implementations of the remaining trap routines.</p>
<p>Input Character</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:trap-getc href=#:trap-getc>TRAP GETC</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=com>/* read a single ASCII char */</span><span class=pln>
reg</span><span class=pun>[</span><span class=pln>R_R0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=typ>uint16_t</span><span class=pun>)</span><span class=pln>getchar</span><span class=pun>();</span><span class=pln>
update_flags</span><span class=pun>(</span><span class=pln>R_R0</span><span class=pun>);</span></code></pre>
<p class=block-usages><small>Used by <a href=#:trap title=TRAP>1</a> </small></p></div>
<p>Output Character</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:trap-out href=#:trap-out>TRAP OUT</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pln>putc</span><span class=pun>((</span><span class=kwd>char</span><span class=pun>)</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>R_R0</span><span class=pun>],</span><span class=pln> stdout</span><span class=pun>);</span><span class=pln>
fflush</span><span class=pun>(</span><span class=pln>stdout</span><span class=pun>);</span></code></pre>
<p class=block-usages><small>Used by <a href=#:trap title=TRAP>1</a> </small></p></div>
<p>Prompt for Input Character</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:trap-in href=#:trap-in>TRAP IN</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    printf</span><span class=pun>(</span><span class=str>"Enter a character: "</span><span class=pun>);</span><span class=pln>
    </span><span class=kwd>char</span><span class=pln> c </span><span class=pun>=</span><span class=pln> getchar</span><span class=pun>();</span><span class=pln>
    putc</span><span class=pun>(</span><span class=pln>c</span><span class=pun>,</span><span class=pln> stdout</span><span class=pun>);</span><span class=pln>
    fflush</span><span class=pun>(</span><span class=pln>stdout</span><span class=pun>);</span><span class=pln>
    reg</span><span class=pun>[</span><span class=pln>R_R0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=typ>uint16_t</span><span class=pun>)</span><span class=pln>c</span><span class=pun>;</span><span class=pln>
    update_flags</span><span class=pun>(</span><span class=pln>R_R0</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:trap title=TRAP>1</a> </small></p></div>
<p>Output String</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:trap-putsp href=#:trap-putsp>TRAP PUTSP</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pun>{</span><span class=pln>
    </span><span class=com>/* one char per byte (two bytes per word)
       here we need to swap back to
       big endian format */</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pun>*</span><span class=pln> c </span><span class=pun>=</span><span class=pln> memory </span><span class=pun>+</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_R0</span><span class=pun>];</span><span class=pln>
    </span><span class=kwd>while</span><span class=pln> </span><span class=pun>(*</span><span class=pln>c</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=kwd>char</span><span class=pln> char1 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(*</span><span class=pln>c</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0xFF</span><span class=pun>;</span><span class=pln>
        putc</span><span class=pun>(</span><span class=pln>char1</span><span class=pun>,</span><span class=pln> stdout</span><span class=pun>);</span><span class=pln>
        </span><span class=kwd>char</span><span class=pln> char2 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(*</span><span class=pln>c</span><span class=pun>)</span><span class=pln> </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>8</span><span class=pun>;</span><span class=pln>
        </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>char2</span><span class=pun>)</span><span class=pln> putc</span><span class=pun>(</span><span class=pln>char2</span><span class=pun>,</span><span class=pln> stdout</span><span class=pun>);</span><span class=pln>
        </span><span class=pun>++</span><span class=pln>c</span><span class=pun>;</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    fflush</span><span class=pun>(</span><span class=pln>stdout</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:trap title=TRAP>1</a> </small></p></div>
<p>Halt Program</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:trap-halt href=#:trap-halt>TRAP HALT</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pln>puts</span><span class=pun>(</span><span class=str>"HALT"</span><span class=pun>);</span><span class=pln>
fflush</span><span class=pun>(</span><span class=pln>stdout</span><span class=pun>);</span><span class=pln>
running </span><span class=pun>=</span><span class=pln> </span><span class=lit>0</span><span class=pun>;</span></code></pre>
<p class=block-usages><small>Used by <a href=#:trap title=TRAP>1</a> </small></p></div>
<h2 id=loading-programs>Loading programs</h2>
<p>We have mentioned a lot about loading and executing instructions from memory, but how do instructions get into memory in the first place? When an assembly program is converted to machine code, the result is a file containing an array of instructions and data. This can be loaded by just copying the contents right into an address in memory.</p>
<p>The first 16 bits of the program file specify the address in memory where the program should start. This address is called the <strong>origin</strong>. It must be read first, after which the rest of the data can be read from the file into memory starting at the origin address.</p>
<p>Here is the code for reading an LC-3 program into memory:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:read-image-file href=#:read-image-file>Read Image File</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>void</span><span class=pln> read_image_file</span><span class=pun>(</span><span class=pln>FILE</span><span class=pun>*</span><span class=pln> file</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=com>/* the origin tells us where in memory to place the image */</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> origin</span><span class=pun>;</span><span class=pln>
    fread</span><span class=pun>(&amp;</span><span class=pln>origin</span><span class=pun>,</span><span class=pln> </span><span class=kwd>sizeof</span><span class=pun>(</span><span class=pln>origin</span><span class=pun>),</span><span class=pln> </span><span class=lit>1</span><span class=pun>,</span><span class=pln> file</span><span class=pun>);</span><span class=pln>
    origin </span><span class=pun>=</span><span class=pln> swap16</span><span class=pun>(</span><span class=pln>origin</span><span class=pun>);</span><span class=pln>

    </span><span class=com>/* we know the maximum file size so we only need one fread */</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> max_read </span><span class=pun>=</span><span class=pln> MEMORY_MAX </span><span class=pun>-</span><span class=pln> origin</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pun>*</span><span class=pln> p </span><span class=pun>=</span><span class=pln> memory </span><span class=pun>+</span><span class=pln> origin</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>size_t</span><span class=pln> read </span><span class=pun>=</span><span class=pln> fread</span><span class=pun>(</span><span class=pln>p</span><span class=pun>,</span><span class=pln> </span><span class=kwd>sizeof</span><span class=pun>(</span><span class=typ>uint16_t</span><span class=pun>),</span><span class=pln> max_read</span><span class=pun>,</span><span class=pln> file</span><span class=pun>);</span><span class=pln>

    </span><span class=com>/* swap to little endian */</span><span class=pln>
    </span><span class=kwd>while</span><span class=pln> </span><span class=pun>(</span><span class=pln>read</span><span class=pun>--</span><span class=pln> </span><span class=pun>&gt;</span><span class=pln> </span><span class=lit>0</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=pun>*</span><span class=pln>p </span><span class=pun>=</span><span class=pln> swap16</span><span class=pun>(*</span><span class=pln>p</span><span class=pun>);</span><span class=pln>
        </span><span class=pun>++</span><span class=pln>p</span><span class=pun>;</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<p>Notice that <code>swap16</code> is called on each loaded value. LC-3 programs are big-endian, but most modern computers are little-endian. So, we need to swap each <code>uint16</code> that is loaded. (If you happen to be using an obscure computer, like an old <a href=https://en.wikipedia.org/wiki/PowerPC#Endian_modes>PPC</a> <a href=https://en.wikipedia.org/wiki/Power_Mac_G4_Cube>Mac</a>, then do not swap.)</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:swap href=#:swap>Swap</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=typ>uint16_t</span><span class=pln> swap16</span><span class=pun>(</span><span class=typ>uint16_t</span><span class=pln> x</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=kwd>return</span><span class=pln> </span><span class=pun>(</span><span class=pln>x </span><span class=pun>&lt;&lt;</span><span class=pln> </span><span class=lit>8</span><span class=pun>)</span><span class=pln> </span><span class=pun>|</span><span class=pln> </span><span class=pun>(</span><span class=pln>x </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>8</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<blockquote><p><strong>Note:</strong> <a href=https://en.wikipedia.org/wiki/Endianness>Endianness</a> refers to how bytes of an integer are interpreted. In little-endian, the first byte is the least significant digit, and in big-endian, it is reversed. As far as I know, the decision is <em>mostly</em> arbitrary. Different companies made different decisions, so now we are left with varying implementations. You do not need to know anything else about endianness for this project.</p></blockquote>
<p>Let’s also add a convenience function for <code>read_image_file</code> which takes a path a string;</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:read-image href=#:read-image>Read Image</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>int</span><span class=pln> read_image</span><span class=pun>(</span><span class=kwd>const</span><span class=pln> </span><span class=kwd>char</span><span class=pun>*</span><span class=pln> image_path</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    FILE</span><span class=pun>*</span><span class=pln> file </span><span class=pun>=</span><span class=pln> fopen</span><span class=pun>(</span><span class=pln>image_path</span><span class=pun>,</span><span class=pln> </span><span class=str>"rb"</span><span class=pun>);</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(!</span><span class=pln>file</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> </span><span class=kwd>return</span><span class=pln> </span><span class=lit>0</span><span class=pun>;</span><span class=pln> </span><span class=pun>};</span><span class=pln>
    read_image_file</span><span class=pun>(</span><span class=pln>file</span><span class=pun>);</span><span class=pln>
    fclose</span><span class=pun>(</span><span class=pln>file</span><span class=pun>);</span><span class=pln>
    </span><span class=kwd>return</span><span class=pln> </span><span class=lit>1</span><span class=pun>;</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<h2 id=memory-mapped-registers>Memory mapped registers</h2>
<p>Some special registers are not accessible from the normal register table. Instead, a special address is reserved for them in memory. To read and write to these registers, you just read and write to their memory location. These are called <strong>memory mapped registers</strong>. They are commonly used to interact with special hardware devices.</p>
<p>The LC-3 has two memory mapped registers that need to be implemented. They are the keyboard status register (<code>KBSR</code>) and keyboard data register (<code>KBDR</code>). The <code>KBSR</code> indicates whether a key has been pressed, and the <code>KBDR</code> identifies which key was pressed.</p>
<p>Although you can request keyboard input using <code>GETC</code>, this blocks execution until input is received. <code>KBSR</code> and <code>KBDR</code> allows you to <a href=https://en.wikipedia.org/wiki/Polling_(computer_science>poll the state</a>) of the device and continue execution, so the program can stay responsive while waiting for input.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:memory-mapped-registers href=#:memory-mapped-registers>Memory Mapped Registers</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>enum</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    MR_KBSR </span><span class=pun>=</span><span class=pln> </span><span class=lit>0xFE00</span><span class=pun>,</span><span class=pln> </span><span class=com>/* keyboard status */</span><span class=pln>
    MR_KBDR </span><span class=pun>=</span><span class=pln> </span><span class=lit>0xFE02</span><span class=pln>  </span><span class=com>/* keyboard data */</span><span class=pln>
</span><span class=pun>};</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<p>Memory mapped registers make memory access a bit more complicated. We can’t read and write to the memory array directly, but must instead call setter and getter functions. When memory is read from <code>KBSR</code>, the getter will check the keyboard and update both memory locations.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:memory-access href=#:memory-access>Memory Access</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>void</span><span class=pln> mem_write</span><span class=pun>(</span><span class=typ>uint16_t</span><span class=pln> address</span><span class=pun>,</span><span class=pln> </span><span class=typ>uint16_t</span><span class=pln> val</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    memory</span><span class=pun>[</span><span class=pln>address</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> val</span><span class=pun>;</span><span class=pln>
</span><span class=pun>}</span><span class=pln>

</span><span class=typ>uint16_t</span><span class=pln> mem_read</span><span class=pun>(</span><span class=typ>uint16_t</span><span class=pln> address</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>address </span><span class=pun>==</span><span class=pln> MR_KBSR</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>check_key</span><span class=pun>())</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            memory</span><span class=pun>[</span><span class=pln>MR_KBSR</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=lit>1</span><span class=pln> </span><span class=pun>&lt;&lt;</span><span class=pln> </span><span class=lit>15</span><span class=pun>);</span><span class=pln>
            memory</span><span class=pun>[</span><span class=pln>MR_KBDR</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> getchar</span><span class=pun>();</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
        </span><span class=kwd>else</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            memory</span><span class=pun>[</span><span class=pln>MR_KBSR</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> </span><span class=lit>0</span><span class=pun>;</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>return</span><span class=pln> memory</span><span class=pun>[</span><span class=pln>address</span><span class=pun>];</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<p>That completes the last component of the VM! Provided that you implemented the rest of the trap routines and instructions, you are almost ready to try it out!</p>
<h2 id=platform-specifics>Platform specifics</h2>
<p>This section contains some tedious details that are needed to access the keyboard and behave nicely.
These are not insightful or relevant to learning about VMs. Feel free to copy paste!
These functions should be declared above your main function.</p>
<h3>Linux/macOS/UNIX</h3>
<p>NOTE: Skip to the next section for the <strong>Windows</strong> versions of these functions.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:input-buffering href=#:input-buffering>Input Buffering</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>struct</span><span class=pln> termios original_tio</span><span class=pun>;</span><span class=pln>

</span><span class=kwd>void</span><span class=pln> disable_input_buffering</span><span class=pun>()</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    tcgetattr</span><span class=pun>(</span><span class=pln>STDIN_FILENO</span><span class=pun>,</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln>original_tio</span><span class=pun>);</span><span class=pln>
    </span><span class=kwd>struct</span><span class=pln> termios new_tio </span><span class=pun>=</span><span class=pln> original_tio</span><span class=pun>;</span><span class=pln>
    new_tio</span><span class=pun>.</span><span class=pln>c_lflag </span><span class=pun>&amp;=</span><span class=pln> </span><span class=pun>~</span><span class=pln>ICANON </span><span class=pun>&amp;</span><span class=pln> </span><span class=pun>~</span><span class=pln>ECHO</span><span class=pun>;</span><span class=pln>
    tcsetattr</span><span class=pun>(</span><span class=pln>STDIN_FILENO</span><span class=pun>,</span><span class=pln> TCSANOW</span><span class=pun>,</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln>new_tio</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span><span class=pln>

</span><span class=kwd>void</span><span class=pln> restore_input_buffering</span><span class=pun>()</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    tcsetattr</span><span class=pun>(</span><span class=pln>STDIN_FILENO</span><span class=pun>,</span><span class=pln> TCSANOW</span><span class=pun>,</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln>original_tio</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span><span class=pln>

</span><span class=typ>uint16_t</span><span class=pln> check_key</span><span class=pun>()</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    fd_set readfds</span><span class=pun>;</span><span class=pln>
    FD_ZERO</span><span class=pun>(&amp;</span><span class=pln>readfds</span><span class=pun>);</span><span class=pln>
    FD_SET</span><span class=pun>(</span><span class=pln>STDIN_FILENO</span><span class=pun>,</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln>readfds</span><span class=pun>);</span><span class=pln>

    </span><span class=kwd>struct</span><span class=pln> timeval timeout</span><span class=pun>;</span><span class=pln>
    timeout</span><span class=pun>.</span><span class=pln>tv_sec </span><span class=pun>=</span><span class=pln> </span><span class=lit>0</span><span class=pun>;</span><span class=pln>
    timeout</span><span class=pun>.</span><span class=pln>tv_usec </span><span class=pun>=</span><span class=pln> </span><span class=lit>0</span><span class=pun>;</span><span class=pln>
    </span><span class=kwd>return</span><span class=pln> </span><span class=kwd>select</span><span class=pun>(</span><span class=lit>1</span><span class=pun>,</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln>readfds</span><span class=pun>,</span><span class=pln> NULL</span><span class=pun>,</span><span class=pln> NULL</span><span class=pun>,</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln>timeout</span><span class=pun>)</span><span class=pln> </span><span class=pun>!=</span><span class=pln> </span><span class=lit>0</span><span class=pun>;</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-alt.cpp>2</span> </small></p></div>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:includes href=#:includes>Includes</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=com>#include</span><span class=pln> </span><span class=str>&lt;stdio.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;stdint.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;signal.h&gt;</span><span class=pln>
</span><span class=com>/* unix only */</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;stdlib.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;unistd.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;fcntl.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;sys/time.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;sys/types.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;sys/termios.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;sys/mman.h&gt;</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c title=/lc3.c>1</a> <span title=/lc3-alt.cpp>2</span> </small></p></div>
<h3>Windows</h3>
<p>NOTE: If you already included the <strong>Unix</strong> versions don’t add these!</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:input-buffering-windows href=#:input-buffering-windows>Input Buffering Windows</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pln>HANDLE hStdin </span><span class=pun>=</span><span class=pln> INVALID_HANDLE_VALUE</span><span class=pun>;</span><span class=pln>
DWORD fdwMode</span><span class=pun>,</span><span class=pln> fdwOldMode</span><span class=pun>;</span><span class=pln>

</span><span class=kwd>void</span><span class=pln> disable_input_buffering</span><span class=pun>()</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    hStdin </span><span class=pun>=</span><span class=pln> </span><span class=typ>GetStdHandle</span><span class=pun>(</span><span class=pln>STD_INPUT_HANDLE</span><span class=pun>);</span><span class=pln>
    </span><span class=typ>GetConsoleMode</span><span class=pun>(</span><span class=pln>hStdin</span><span class=pun>,</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln>fdwOldMode</span><span class=pun>);</span><span class=pln> </span><span class=com>/* save old mode */</span><span class=pln>
    fdwMode </span><span class=pun>=</span><span class=pln> fdwOldMode
            </span><span class=pun>^</span><span class=pln> ENABLE_ECHO_INPUT  </span><span class=com>/* no input echo */</span><span class=pln>
            </span><span class=pun>^</span><span class=pln> ENABLE_LINE_INPUT</span><span class=pun>;</span><span class=pln> </span><span class=com>/* return when one or
                                    more characters are available */</span><span class=pln>
    </span><span class=typ>SetConsoleMode</span><span class=pun>(</span><span class=pln>hStdin</span><span class=pun>,</span><span class=pln> fdwMode</span><span class=pun>);</span><span class=pln> </span><span class=com>/* set new mode */</span><span class=pln>
    </span><span class=typ>FlushConsoleInputBuffer</span><span class=pun>(</span><span class=pln>hStdin</span><span class=pun>);</span><span class=pln> </span><span class=com>/* clear buffer */</span><span class=pln>
</span><span class=pun>}</span><span class=pln>

</span><span class=kwd>void</span><span class=pln> restore_input_buffering</span><span class=pun>()</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=typ>SetConsoleMode</span><span class=pun>(</span><span class=pln>hStdin</span><span class=pun>,</span><span class=pln> fdwOldMode</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span><span class=pln>

</span><span class=typ>uint16_t</span><span class=pln> check_key</span><span class=pun>()</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=kwd>return</span><span class=pln> </span><span class=typ>WaitForSingleObject</span><span class=pun>(</span><span class=pln>hStdin</span><span class=pun>,</span><span class=pln> </span><span class=lit>1000</span><span class=pun>)</span><span class=pln> </span><span class=pun>==</span><span class=pln> WAIT_OBJECT_0 </span><span class=pun>&amp;&amp;</span><span class=pln> _kbhit</span><span class=pun>();</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <span title=/lc3-win.c>1</span> <span title=/lc3-alt-win.cpp>2</span> </small></p></div>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:windows-includes href=#:windows-includes>Windows Includes</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=com>#include</span><span class=pln> </span><span class=str>&lt;stdio.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;stdint.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;signal.h&gt;</span><span class=pln>
</span><span class=com>/* windows only */</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;Windows.h&gt;</span><span class=pln>
</span><span class=com>#include</span><span class=pln> </span><span class=str>&lt;conio.h&gt;</span><span class=pln>  </span><span class=com>// _kbhit</span></code></pre>
<p class=block-usages><small>Used by <span title=/lc3-win.c>1</span> <span title=/lc3-alt-win.cpp>2</span> </small></p></div>
<h3>All platforms</h3>
<p>To properly handle input to the terminal, we need to adjust some buffering settings.
The implementation for these varies for each platform and should have been defined above.</p>
<p>We include this setup code at the beginning of the program (start of main).</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:setup href=#:setup>Setup</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pln>signal</span><span class=pun>(</span><span class=pln>SIGINT</span><span class=pun>,</span><span class=pln> handle_interrupt</span><span class=pun>);</span><span class=pln>
disable_input_buffering</span><span class=pun>();</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> <span title=/lc3-alt.cpp>2</span> <span title=/lc3-alt-win.cpp>3</span> </small></p></div>
<p>When the program is interrupted, we want to restore the terminal settings back to normal.
This should be done at the end of the program.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:shutdown href=#:shutdown>Shutdown</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=pln>restore_input_buffering</span><span class=pun>();</span></code></pre>
<p class=block-usages><small>Used by <a href=#:main-loop title="Main Loop">1</a> <span title=/lc3-alt.cpp>2</span> <span title=/lc3-alt-win.cpp>3</span> </small></p></div>
<p>Settings should also be restored if we receive a signal to end the program.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:handle-interrupt href=#:handle-interrupt>Handle Interrupt</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>void</span><span class=pln> handle_interrupt</span><span class=pun>(</span><span class=kwd>int</span><span class=pln> signal</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    restore_input_buffering</span><span class=pun>();</span><span class=pln>
    printf</span><span class=pun>(</span><span class=str>"\n"</span><span class=pun>);</span><span class=pln>
    </span><span class=kwd>exit</span><span class=pun>(-</span><span class=lit>2</span><span class=pun>);</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <a href=#:lc3.c_2 title=/lc3.c>1</a> <span title=/lc3-win.c>2</span> <span title=/lc3-alt.cpp>3</span> <span title=/lc3-alt-win.cpp>4</span> </small></p></div>
<p>Everything we have written so far should have been added to the C file in the following order:</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:lc3.c_2 href=#:lc3.c_2>/lc3.c</a></em></strong> <a href=#:lc3.c>+=</a></span>
<pre class="prettyprint prettyprinted"><code><em class="block-link nocode"><a href=#:memory-mapped-registers>@{Memory Mapped Registers}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:trap-codes>@{TRAP Codes}</a></em><span class=pln>

</span><em class="block-link nocode"><a href=#:memory-storage>@{Memory Storage}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:register-storage>@{Register Storage}</a></em><span class=pln>

</span><em class="block-link nocode"><a href=#:input-buffering>@{Input Buffering}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:handle-interrupt>@{Handle Interrupt}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:sign-extend>@{Sign Extend}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:swap>@{Swap}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:update-flags>@{Update Flags}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:read-image-file>@{Read Image File}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:read-image>@{Read Image}</a></em><span class=pln>
</span><em class="block-link nocode"><a href=#:memory-access>@{Memory Access}</a></em><span class=pln>

</span><em class="block-link nocode"><a href=#:main-loop>@{Main Loop}</a></em>
</code></pre>
</div>
<h2 id=running-the-vm>Running the VM</h2>
<p>You can now build and run the LC-3 VM!</p>
<ol>
<li><p>Compile the VM with your favorite C compiler.
(Final source for <a href=https://www.jmeiners.com/lc3-vm/src/lc3.c>unix</a>, <a href=https://www.jmeiners.com/lc3-vm/src/lc3-win.c>windows</a>).</p>
<pre><code> $ gcc lc3.c -o lc3-vm
</code></pre></li>
<li><p>Download the assembled version of <a href=https://www.jmeiners.com/lc3-vm/supplies/2048.obj>2048</a> or <a href=https://www.jmeiners.com/lc3-vm/supplies/rogue.obj>Rogue</a>.</p></li>
<li><p>Run the VM with the .obj file as an argument:</p>
<pre><code> $ lc3-vm path/to/2048.obj
</code></pre></li>
<li><p>Play 2048!</p>
<pre><code> Control the game using WASD keys.
 Are you on an ANSI terminal (y/n)? y
 +--------------------------+
 |                          |
 |                          |
 |                          |
 |                     2    |
 |                          |
 |   2                      |
 |                          |
 |                          |
 |                          |
 +--------------------------+
</code></pre></li>
</ol>
<h3>Debugging</h3>
<p>If the program doesn’t work correctly, it is likely because you programmed an instruction incorrectly. This can be tricky to debug. I recommend reading through the assembly source code of an LC-3 program while simultaneously using a debugger to step through the VM instructions one at a time. As you read the assembly, make sure the VM goes to the instruction that you expect it to. If a discrepancy occurs, you will then know which instruction caused the issue. Reread its specification and double check your code.</p>
<h2 id=alternate-c-technique>Alternate C++ technique</h2>
<p>Here is an advanced way of organizing instructions that makes the code a whole lot shorter.
This section is entirely optional.</p>
<p>You probably noticed that most of the instructions repeat similar tasks.
For example, several use indirect addressing or sign extend a value and add it to the current PC value.
Wouldn’t it be nice if we could write this code once for all?</p>
<p>The tricky part is that it’s not clear how to condense this repetition into additional functions, as they need surrounding context.
But what we can do is utilize the power of C++ generics to stitch together snippets of functionality at compile time.
The idea is to think of instruction execution as a pipeline of smaller proccessing steps.
Each kind of instruction is just a subset or “permutation” of the available steps.</p>
<p>We will implement this using bitwise flags.
A 1 in the bit corresponding to the instruction number indicates the compiler should include this section of code for that instruction,
while a 0 leaves it out.</p>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:instruction-c- href=#:instruction-c->Instruction C++</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>template</span><span class=pln> </span><span class=pun>&lt;</span><span class=kwd>unsigned</span><span class=pln> op</span><span class=pun>&gt;</span><span class=pln>
</span><span class=kwd>void</span><span class=pln> ins</span><span class=pun>(</span><span class=typ>uint16_t</span><span class=pln> instr</span><span class=pun>)</span><span class=pln>
</span><span class=pun>{</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> r0</span><span class=pun>,</span><span class=pln> r1</span><span class=pun>,</span><span class=pln> r2</span><span class=pun>,</span><span class=pln> imm5</span><span class=pun>,</span><span class=pln> imm_flag</span><span class=pun>;</span><span class=pln>
    </span><span class=typ>uint16_t</span><span class=pln> pc_plus_off</span><span class=pun>,</span><span class=pln> base_plus_off</span><span class=pun>;</span><span class=pln>

    </span><span class=kwd>constexpr</span><span class=pln> </span><span class=typ>uint16_t</span><span class=pln> opbit </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=lit>1</span><span class=pln> </span><span class=pun>&lt;&lt;</span><span class=pln> op</span><span class=pun>);</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x4EEE</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> r0 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln> </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x12F3</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> r1 </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>6</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln> </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0022</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        imm_flag </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>5</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1</span><span class=pun>;</span><span class=pln>

        </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>imm_flag</span><span class=pun>)</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            imm5 </span><span class=pun>=</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1F</span><span class=pun>,</span><span class=pln> </span><span class=lit>5</span><span class=pun>);</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
        </span><span class=kwd>else</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            r2 </span><span class=pun>=</span><span class=pln> instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x00C0</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>   </span><span class=com>// Base + offset</span><span class=pln>
        base_plus_off </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x3F</span><span class=pun>,</span><span class=pln> </span><span class=lit>6</span><span class=pun>);</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x4C0D</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=com>// Indirect address</span><span class=pln>
        pc_plus_off </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x1FF</span><span class=pun>,</span><span class=pln> </span><span class=lit>9</span><span class=pun>);</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0001</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=com>// BR</span><span class=pln>
        </span><span class=typ>uint16_t</span><span class=pln> cond </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>9</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7</span><span class=pun>;</span><span class=pln>
        </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>cond </span><span class=pun>&amp;</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_COND</span><span class=pun>])</span><span class=pln> </span><span class=pun>{</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> pc_plus_off</span><span class=pun>;</span><span class=pln> </span><span class=pun>}</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0002</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln>  </span><span class=com>// ADD</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>imm_flag</span><span class=pun>)</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> imm5</span><span class=pun>;</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
        </span><span class=kwd>else</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r2</span><span class=pun>];</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0020</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln>  </span><span class=com>// AND</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>imm_flag</span><span class=pun>)</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> imm5</span><span class=pun>;</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
        </span><span class=kwd>else</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>]</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r2</span><span class=pun>];</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0200</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> </span><span class=pun>~</span><span class=pln>reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>];</span><span class=pln> </span><span class=pun>}</span><span class=pln> </span><span class=com>// NOT</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x1000</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>];</span><span class=pln> </span><span class=pun>}</span><span class=pln> </span><span class=com>// JMP</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0010</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln>  </span><span class=com>// JSR</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
        </span><span class=typ>uint16_t</span><span class=pln> long_flag </span><span class=pun>=</span><span class=pln> </span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&gt;&gt;</span><span class=pln> </span><span class=lit>11</span><span class=pun>)</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>1</span><span class=pun>;</span><span class=pln>
        reg</span><span class=pun>[</span><span class=pln>R_R7</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>];</span><span class=pln>
        </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=pln>long_flag</span><span class=pun>)</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            pc_plus_off </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>+</span><span class=pln> sign_extend</span><span class=pun>(</span><span class=pln>instr </span><span class=pun>&amp;</span><span class=pln> </span><span class=lit>0x7FF</span><span class=pun>,</span><span class=pln> </span><span class=lit>11</span><span class=pun>);</span><span class=pln>
            reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> pc_plus_off</span><span class=pun>;</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
        </span><span class=kwd>else</span><span class=pln>
        </span><span class=pun>{</span><span class=pln>
            reg</span><span class=pun>[</span><span class=pln>R_PC</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r1</span><span class=pun>];</span><span class=pln>
        </span><span class=pun>}</span><span class=pln>
    </span><span class=pun>}</span><span class=pln>

    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0004</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> mem_read</span><span class=pun>(</span><span class=pln>pc_plus_off</span><span class=pun>);</span><span class=pln> </span><span class=pun>}</span><span class=pln> </span><span class=com>// LD</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0400</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> mem_read</span><span class=pun>(</span><span class=pln>mem_read</span><span class=pun>(</span><span class=pln>pc_plus_off</span><span class=pun>));</span><span class=pln> </span><span class=pun>}</span><span class=pln> </span><span class=com>// LDI</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0040</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> mem_read</span><span class=pun>(</span><span class=pln>base_plus_off</span><span class=pun>);</span><span class=pln> </span><span class=pun>}</span><span class=pln>  </span><span class=com>// LDR</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x4000</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]</span><span class=pln> </span><span class=pun>=</span><span class=pln> pc_plus_off</span><span class=pun>;</span><span class=pln> </span><span class=pun>}</span><span class=pln> </span><span class=com>// LEA</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0008</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> mem_write</span><span class=pun>(</span><span class=pln>pc_plus_off</span><span class=pun>,</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]);</span><span class=pln> </span><span class=pun>}</span><span class=pln> </span><span class=com>// ST</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0800</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> mem_write</span><span class=pun>(</span><span class=pln>mem_read</span><span class=pun>(</span><span class=pln>pc_plus_off</span><span class=pun>),</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]);</span><span class=pln> </span><span class=pun>}</span><span class=pln> </span><span class=com>// STI</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x0080</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> mem_write</span><span class=pun>(</span><span class=pln>base_plus_off</span><span class=pun>,</span><span class=pln> reg</span><span class=pun>[</span><span class=pln>r0</span><span class=pun>]);</span><span class=pln> </span><span class=pun>}</span><span class=pln> </span><span class=com>// STR</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x8000</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln>  </span><span class=com>// TRAP</span><span class=pln>
    </span><span class=pun>{</span><span class=pln>
         </span><em class="block-link nocode"><a href=#:trap>@{TRAP}</a></em><span class=pln>
    </span><span class=pun>}</span><span class=pln>
    </span><span class=com>//if (0x0100 &amp; opbit) { } // RTI</span><span class=pln>
    </span><span class=kwd>if</span><span class=pln> </span><span class=pun>(</span><span class=lit>0x4666</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln> opbit</span><span class=pun>)</span><span class=pln> </span><span class=pun>{</span><span class=pln> update_flags</span><span class=pun>(</span><span class=pln>r0</span><span class=pun>);</span><span class=pln> </span><span class=pun>}</span><span class=pln>
</span><span class=pun>}</span></code></pre>
<p class=block-usages><small>Used by <span title=/lc3-alt.cpp>1</span> <span title=/lc3-alt-win.cpp>2</span> </small></p></div>
<div class=code-block>
<span class=block-header>
<strong class=block-title><em><a id=:op-table href=#:op-table>Op Table</a></em></strong></span>
<pre class="prettyprint prettyprinted"><code><span class=kwd>static</span><span class=pln> </span><span class=kwd>void</span><span class=pln> </span><span class=pun>(*</span><span class=pln>op_table</span><span class=pun>[</span><span class=lit>16</span><span class=pun>])(</span><span class=typ>uint16_t</span><span class=pun>)</span><span class=pln> </span><span class=pun>=</span><span class=pln> </span><span class=pun>{</span><span class=pln>
    ins</span><span class=pun>&lt;</span><span class=lit>0</span><span class=pun>&gt;,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>1</span><span class=pun>&gt;,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>2</span><span class=pun>&gt;,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>3</span><span class=pun>&gt;,</span><span class=pln>
    ins</span><span class=pun>&lt;</span><span class=lit>4</span><span class=pun>&gt;,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>5</span><span class=pun>&gt;,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>6</span><span class=pun>&gt;,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>7</span><span class=pun>&gt;,</span><span class=pln>
    NULL</span><span class=pun>,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>9</span><span class=pun>&gt;,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>10</span><span class=pun>&gt;,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>11</span><span class=pun>&gt;,</span><span class=pln>
    ins</span><span class=pun>&lt;</span><span class=lit>12</span><span class=pun>&gt;,</span><span class=pln> NULL</span><span class=pun>,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>14</span><span class=pun>&gt;,</span><span class=pln> ins</span><span class=pun>&lt;</span><span class=lit>15</span><span class=pun>&gt;</span><span class=pln>
</span><span class=pun>};</span></code></pre>
<p class=block-usages><small>Used by <span title=/lc3-alt.cpp>1</span> <span title=/lc3-alt-win.cpp>2</span> </small></p></div>
<p>Not only does this method reduce code duplication, but it’s also closer to how a computer would actually be wired in hardware,
where each processing step must occupy physical space on a chip.</p>
<blockquote><p><strong>Note:</strong> I learned about this technique from <a href="https://www.youtube.com/watch?v=QIUVSD3yqqE">Bisqwit’s NES emulator</a>.
If you are interested in emulation, or the NES, I highly recommend his videos.</p></blockquote>
<p>The rest of the C++ version uses the code we already wrote!
The full source is here: <a href=https://www.jmeiners.com/lc3-vm/src/lc3-alt.cpp>unix</a>, <a href=https://www.jmeiners.com/lc3-vm/src/lc3-alt-win.cpp>windows</a>.</p>
<h2 id=contributions>Contributions</h2>
<p><a href=https://github.com/atul-g/rust_vm>atul-g</a> has contributed a handy <a href=https://www.jmeiners.com/lc3-vm/supplies/lc3-ref-card.png>reference card</a>
that summarizes how the whole system works.</p>
<p>Many programmers have completed this tutorial and shared their implementations in various languages.
A selection of these used to be listed, but since there were so many,
we decided to utilize GitHub tags to organize them.</p>
<ul>
<li><a href="https://github.com/topics/lc3?l=c">C</a></li>
<li><a href="https://github.com/topics/lc3?l=c%2B%2B">C++</a></li>
<li><a href="https://github.com/topics/lc3?l=common-lisp">Common Lisp</a></li>
<li><a href="https://github.com/topics/lc3?l=crystal">Crystal</a></li>
<li><a href="https://github.com/topics/lc3?l=f%23">F#</a></li>
<li><a href="https://github.com/topics/lc3?l=go">Go</a></li>
<li><a href="https://github.com/topics/lc3?l=haskell">Haskell</a></li>
<li><a href="https://github.com/topics/lc3?l=java">Java</a></li>
<li><a href="https://github.com/topics/lc3?l=javascript">JavaScript</a></li>
<li><a href="https://github.com/topics/lc3?l=kotlin">Kotlin</a></li>
<li><a href="https://github.com/topics/lc3?l=ocaml">OCaml</a></li>
<li><a href="https://github.com/topics/lc3?l=python">Python</a></li>
<li><a href="https://github.com/topics/lc3?l=racket">Racket</a></li>
<li><a href="https://github.com/topics/lc3?l=rust">Rust</a></li>
<li><a href="https://github.com/topics/lc3?l=scala">Scala</a></li>
<li><a href="https://github.com/topics/lc3?l=swift">Swift</a></li>
<li><a href="https://github.com/topics/lc3?l=typescript">TypeScript</a></li>
<li><a href="https://github.com/topics/lc3?l=zig">Zig</a></li>
</ul>
<p>To list your own project, just make sure it is tagged with the GitHub topic <code>lc3</code>.
If your language is missing, feel free to submit a pull request.</p>
<p>Special thanks to <a href=https://github.com/inkydragon>inkydragon</a> for contributing Windows platform support.</p>
<p>Want to contribute? We need help with an integration test.
This is a good <a href=https://github.com/justinmeiners/lc3-vm/issues/13>first issue</a> to learn from.</p>
<div style=all:initial><div style=all:initial id=__hcfy__><template shadowrootmode=open><style class=sf-hidden>#root{-webkit-text-size-adjust:100%;box-sizing:border-box;font-size:14px;font-weight:400;letter-spacing:0;line-height:1.28581;text-transform:none;color:#182026;font-family:-apple-system,"BlinkMacSystemFont","Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Open Sans","Helvetica Neue","Icons16",sans-serif;touch-action:manipulation}#root>.bp5-portal{z-index:9999999999}</style><style class=sf-hidden>#translate-panel{background-color:#f6f7f9;display:flex;flex-direction:column;padding-bottom:8px}.bp5-dark #translate-panel{background-color:#252a31}#translate-panel .fixed{flex-shrink:0;margin-bottom:10px}#translate-panel .body{flex-grow:1;overflow:auto;overscroll-behavior:contain}#translate-panel .body::-webkit-scrollbar{width:8px;background-color:rgba(0,0,0,0);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar:hover{background-color:rgba(0,0,0,.09)}#translate-panel .body::-webkit-scrollbar-thumb:vertical{background:rgba(0,0,0,.5);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar-thumb:vertical:active{background:rgba(0,0,0,.61);-webkit-border-radius:100px}#translate-panel.size-small,#translate-panel.size-small h6.bp5-heading,#translate-panel.size-small .bp5-control.bp5-large,#translate-panel.size-small textarea.bp5-input.bp5-small{font-size:14px}#translate-panel.size-small .phonetic-item,#translate-panel.size-small .quick-settings a{font-size:12px}#translate-panel.size-middle,#translate-panel.size-middle h6.bp5-heading,#translate-panel.size-middle .bp5-control.bp5-large,#translate-panel.size-middle textarea.bp5-input{font-size:18px}#translate-panel.size-middle .phonetic-item,#translate-panel.size-middle .quick-settings a{font-size:14px}#translate-panel.size-large,#translate-panel.size-large h6.bp5-heading,#translate-panel.size-large .bp5-control.bp5-large,#translate-panel.size-large textarea.bp5-input.bp5-large{font-size:22px}#translate-panel.size-large .source,#translate-panel.size-large .phonetic-item,#translate-panel.size-large .quick-settings a{font-size:18px}#translate-panel .bp5-button.bp5-small,#translate-panel .bp5-small .bp5-button{min-height:20px;min-width:20px}#translate-panel .header{display:flex;align-items:center;padding:4px 6px 4px 10px;border-bottom:1px solid #d1d1d1}.bp5-dark #translate-panel .header{border-bottom-color:rgba(17,20,24,.4)}#translate-panel .header .drag-block{min-width:5px;flex-shrink:0;flex-grow:1;align-self:stretch}#translate-panel .header .left{flex-shrink:0;display:flex}#translate-panel .header .right{flex-shrink:0;display:flex;align-items:center}#translate-panel .header .right .bp5-icon-arrow-right{flex-shrink:0;margin:0 5px}#translate-panel .header .right>.bp5-button{flex-shrink:0;margin:0 1px}#translate-panel .header .right>.bp5-button:last-child{margin-right:0}#translate-panel .quick-settings{padding:4px 9px;margin:0 1px}#translate-panel .quick-settings>div{margin-bottom:5px}#translate-panel .quick-settings .bp5-control{margin-bottom:0}#translate-panel .query-text{position:relative;padding:10px 10px 2px 10px}#translate-panel .query-text textarea.bp5-input{min-height:44px;font-family:system-ui,-apple-system,"Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";overscroll-behavior:contain}#translate-panel .query-text .translate-btn{position:absolute;opacity:.6}#translate-panel .query-text .translate-btn:hover{opacity:1}#translate-panel .body{padding:0 10px}#translate-panel .body .bp5-card:first-child{margin-top:1px}#translate-panel .body .bp5-card:last-child{margin-bottom:1px}#translate-panel .body .no-api{margin:20px 0}.result-block{margin:8px 0;padding:2px 5px}.result-block .bp5-button{visibility:hidden}.result-block .error .bp5-button,.result-block:hover .bp5-button{visibility:visible}.result-block .legend{display:flex;align-items:center;justify-content:space-between}.result-block .legend .legend-left{display:flex;align-items:center}.result-block .legend .api-ico,.result-block .legend .bp5-heading{flex-shrink:0;white-space:nowrap}.result-block .legend .api-ico{display:inline-block;width:14px;height:14px;background-size:contain;margin-right:3px}.result-block .legend .bp5-heading{margin-bottom:0;margin-right:10px}.result-block .legend .source{cursor:pointer;font-size:12px;display:inline-flex;align-items:center}.result-block .legend .source .source-text{overflow:hidden}.result-block .legend .source .bp5-icon{position:relative;top:-1px;margin-left:1px}.result-block .phonetic{display:flex;flex-wrap:wrap}.result-block .phonetic .phonetic-item{display:flex;align-items:center;font-size:12px}.result-block .phonetic .phonetic-item:not(:last-child){margin-right:12px}.result-block .common-result p{line-height:1.3;margin:2px 0;overflow-wrap:break-word}.result-block .common-result .dict a{text-decoration:underline}.result-block .error{font-size:12px;padding:5px 10px}.result-block .dict-pos{margin-right:5px}.external-translators{margin-bottom:3px;padding:0;display:flex;flex-wrap:wrap}.external-translators>div{margin:0 5px 5px 0}.quick-links a{margin:0 5px 5px 0}#popper-container{width:250px;max-width:100%;position:absolute;left:0;top:0;z-index:9999999998;touch-action:none;transition:opacity .2s;background-color:#f6f7f9}.bp5-dark #popper-container{background-color:#252a31}#popper-container.show{opacity:1;pointer-events:auto;-moz-user-select:auto;user-select:auto}#popper-container,#popper-container[data-popper-reference-hidden=true]{opacity:0;pointer-events:none;-moz-user-select:none;user-select:none}#popper-container .drag-block{cursor:-webkit-grab;cursor:grab}#popper-container.pin{position:fixed}#popper-container.pin .arrow{display:none}#popper-container .arrow,#popper-container .arrow::before{position:absolute;width:8px;height:8px;z-index:-1}#popper-container .arrow::before{content:"";transform:rotate(45deg);background:#f6f7f9}.bp5-dark #popper-container .arrow::before{background-color:#252a31}#popper-container .arrow{display:none}#popper-container.show[data-popper-placement]:not([data-popper-reference-hidden=true]) .arrow{display:block}#popper-container[data-popper-placement^=top] .arrow{bottom:-5px}#popper-container[data-popper-placement^=top] .arrow::before{border-right:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#popper-container[data-popper-placement^=bottom] .arrow{top:-5px}#popper-container[data-popper-placement^=bottom] .arrow::before{border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=left] .arrow{right:-5px}#popper-container[data-popper-placement^=left] .arrow::before{border-right:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=right] .arrow{left:-5px}#popper-container[data-popper-placement^=right] .arrow::before{border-left:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#translate-btn{display:none;position:absolute;z-index:9999999999;left:0;top:0}#translate-btn .bp5-button{padding:2px;min-width:0;min-height:0}#translate-btn .btn-icon{width:18px;height:18px;background-image:url(moz-extension://72d6ca68-5609-1440-b1ba-15daf8cbdb2d/logo.png);background-size:contain}.bp5-dark #translate-btn .btn-icon{background-image:url(moz-extension://72d6ca68-5609-1440-b1ba-15daf8cbdb2d/logowhite36.png)}#translate-btn.show{display:block}.translate-type-selector .bp5-label{display:inline}.translate-type-selector .bp5-radio{margin-bottom:0}#ocr-container{position:fixed;z-index:99999999999999;left:0;top:0;right:0;bottom:0}#ocr-container .toolbar{display:none;position:absolute;z-index:1}#ocr-container img{max-width:100%}#app{cursor:default}.switch-pin{flex-shrink:0;cursor:pointer}.switch-pin .bp5-icon-pin{transition:transform .2s,color .2s;transform:rotate(-45deg)}.pin .switch-pin .bp5-icon-pin{transform:rotate(-70deg)}.cut-btn{margin-left:2px}.app-toaster-container{position:fixed!important;z-index:9999999999!important}.app-toaster-container .bp5-toast{min-width:auto}#web-trs-panel .app-toaster-container{padding-right:0;padding-left:0}#web-trs-panel .page-trs-form-group{margin:0 0 0 0;align-items:center}#web-trs-panel .page-trs-form-group>label{width:70px}</style><div id=root dir=ltr class=bp5-dark><div id=app class=bp5-dark><div id=translate-btn class=sf-hidden></div><div id=popper-container style=width:250px;transform:translate(0px) class=bp5-elevation-4><div id=translate-panel class=size-small><div class=fixed><div class=header><div class=left><div class=switch-pin><button type=button class="bp5-button bp5-minimal bp5-small"><span aria-hidden=true class="bp5-icon bp5-icon-pin"><svg data-icon=pin height=14 role=img viewBox="0 0 16 16" width=14><path d="M9.41.92c-.51.51-.41 1.5.15 2.56L4.34 7.54C2.8 6.48 1.45 6.05.92 6.58l3.54 3.54-3.54 4.95 4.95-3.54 3.54 3.54c.53-.53.1-1.88-.96-3.42l4.06-5.22c1.06.56 2.04.66 2.55.15L9.41.92z" fill-rule=evenodd></path></svg></span></button></div><button type=button class="bp5-button bp5-minimal bp5-small cut-btn" title=截图翻译><span aria-hidden=true class="bp5-icon bp5-icon-cut"><svg data-icon=cut height=14 role=img viewBox="0 0 16 16" width=14><path d="M13 2s.71-1.29 0-2L8.66 5.07l1.05 1.32L13 2zm.07 8c-.42 0-.82.09-1.18.26L3.31 0c-.69.71 0 2 0 2l3.68 5.02-2.77 3.24A2.996 2.996 0 000 13c0 1.66 1.34 3 3 3s3-1.34 3-3c0-.46-.11-.89-.29-1.27L8.1 8.54l2.33 3.19c-.18.39-.29.82-.29 1.27 0 1.66 1.31 3 2.93 3S16 14.66 16 13s-1.31-3-2.93-3zM3 14c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm10.07 0c-.54 0-.98-.45-.98-1s.44-1 .98-1 .98.45.98 1-.44 1-.98 1z" fill-rule=evenodd></path></svg></span></button><button type=button class="bp5-button bp5-minimal bp5-small cut-btn" title=网页全文翻译><span aria-hidden=true class="bp5-icon bp5-icon-translate"><svg data-icon=translate height=14 role=img viewBox="0 0 16 16" width=14><path d="M15.89 14.56l-3.99-8h-.01c-.17-.33-.5-.56-.89-.56s-.72.23-.89.56h-.01L9 8.76 7.17 7.38l.23-.18C8.37 6.47 9 5.31 9 4V3h1c.55 0 1-.45 1-1s-.45-1-1-1H7c0-.55-.45-1-1-1H5c-.55 0-1 .45-1 1H1c-.55 0-1 .45-1 1s.45 1 1 1h6v1c0 .66-.32 1.25-.82 1.61l-.68.51-.68-.5C4.32 5.25 4 4.66 4 4H2c0 1.31.63 2.47 1.6 3.2l.23.17L1.4 9.2l.01.01C1.17 9.4 1 9.67 1 10c0 .55.45 1 1 1 .23 0 .42-.09.59-.21l.01.01 2.9-2.17 2.6 1.95-1.99 3.98h.01c-.07.13-.12.28-.12.44 0 .55.45 1 1 1 .39 0 .72-.23.89-.56h.01L8.62 14h4.76l.72 1.45h.01c.17.32.5.55.89.55.55 0 1-.45 1-1 0-.16-.05-.31-.11-.44zM9.62 12L11 9.24 12.38 12H9.62z" fill-rule=evenodd></path></svg></span></button><button type=button class="bp5-button bp5-minimal bp5-small cut-btn" title=音视频翻译 style=margin-right:2px><span aria-hidden=true class="bp5-icon bp5-icon-video"><svg data-icon=video height=14 role=img viewBox="0 0 16 16" width=14><path d="M15 2H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h14c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zM5 11V5l6 3-6 3z" fill-rule=evenodd></path></svg></span></button><button type=button title=图片翻译 class="bp5-button bp5-minimal bp5-small"><span aria-hidden=true class="bp5-icon bp5-icon-media"><svg data-icon=media height=14 role=img viewBox="0 0 16 16" width=14><path d="M11.99 6.99c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm3-5h-14c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-10c0-.55-.45-1-1-1zm-1 9l-5-3-1 2-3-4-3 5v-7h12v7z" fill-rule=evenodd></path></svg></span></button><button type=button title=语音翻译 class="bp5-button bp5-minimal bp5-small"><span class=bp5-icon><svg version=1.1 id=Capa_1 width=14 height=14 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink x=0px y=0px viewBox="0 0 490.9 490.9" xml:space=preserve><g><g><path d="M245.5,322.9c53,0,96.2-43.2,96.2-96.2V96.2c0-53-43.2-96.2-96.2-96.2s-96.2,43.2-96.2,96.2v130.5 C149.3,279.8,192.5,322.9,245.5,322.9z M173.8,96.2c0-39.5,32.2-71.7,71.7-71.7s71.7,32.2,71.7,71.7v130.5 c0,39.5-32.2,71.7-71.7,71.7s-71.7-32.2-71.7-71.7V96.2z"></path><path d="M94.4,214.5c-6.8,0-12.3,5.5-12.3,12.3c0,85.9,66.7,156.6,151.1,162.8v76.7h-63.9c-6.8,0-12.3,5.5-12.3,12.3 s5.5,12.3,12.3,12.3h152.3c6.8,0,12.3-5.5,12.3-12.3s-5.5-12.3-12.3-12.3h-63.9v-76.7c84.4-6.3,151.1-76.9,151.1-162.8 c0-6.8-5.5-12.3-12.3-12.3s-12.3,5.5-12.3,12.3c0,76.6-62.3,138.9-138.9,138.9s-138.9-62.3-138.9-138.9 C106.6,220,101.2,214.5,94.4,214.5z"></path></g></g></svg></span></button></div><div class=drag-block title=按住不放可以拖动></div><div class=right><button type=button disabled title=添加到收藏夹 class="bp5-button bp5-disabled bp5-minimal bp5-small" tabindex=-1><span aria-hidden=true class="bp5-icon bp5-icon-star-empty"><svg data-icon=star-empty height=14 role=img viewBox="0 0 16 16" width=14><path d="M16 6.11l-5.53-.84L8 0 5.53 5.27 0 6.11l4 4.1L3.06 16 8 13.27 12.94 16 12 10.21l4-4.1zM4.91 13.2l.59-3.62L3 7.02l3.45-.53L8 3.2l1.55 3.29 3.45.53-2.5 2.56.59 3.62L8 11.49 4.91 13.2z" fill-rule=evenodd></path></svg></span></button><button type=button class="bp5-button bp5-minimal bp5-small settings" title=快捷设置><span aria-hidden=true class="bp5-icon bp5-icon-cog"><svg data-icon=cog height=14 role=img viewBox="0 0 16 16" width=14><path d="M15.19 6.39h-1.85c-.11-.37-.27-.71-.45-1.04l1.36-1.36c.31-.31.31-.82 0-1.13l-1.13-1.13a.803.803 0 00-1.13 0l-1.36 1.36c-.33-.17-.67-.33-1.04-.44V.79c0-.44-.36-.8-.8-.8h-1.6c-.44 0-.8.36-.8.8v1.86c-.39.12-.75.28-1.1.47l-1.3-1.3c-.3-.3-.79-.3-1.09 0L1.82 2.91c-.3.3-.3.79 0 1.09l1.3 1.3c-.2.34-.36.7-.48 1.09H.79c-.44 0-.8.36-.8.8v1.6c0 .44.36.8.8.8h1.85c.11.37.27.71.45 1.04l-1.36 1.36c-.31.31-.31.82 0 1.13l1.13 1.13c.31.31.82.31 1.13 0l1.36-1.36c.33.18.67.33 1.04.44v1.86c0 .44.36.8.8.8h1.6c.44 0 .8-.36.8-.8v-1.86c.39-.12.75-.28 1.1-.47l1.3 1.3c.3.3.79.3 1.09 0l1.09-1.09c.3-.3.3-.79 0-1.09l-1.3-1.3c.19-.35.36-.71.48-1.1h1.85c.44 0 .8-.36.8-.8v-1.6a.816.816 0 00-.81-.79zm-7.2 4.6c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z" fill-rule=evenodd></path></svg></span></button><button type=button title=关闭(Esc) class="bp5-button bp5-minimal bp5-small"><span aria-hidden=true class="bp5-icon bp5-icon-cross"><svg data-icon=cross height=18 role=img viewBox="0 0 16 16" width=18><path d="M9.41 8l3.29-3.29c.19-.18.3-.43.3-.71a1.003 1.003 0 00-1.71-.71L8 6.59l-3.29-3.3a1.003 1.003 0 00-1.42 1.42L6.59 8 3.3 11.29c-.19.18-.3.43-.3.71a1.003 1.003 0 001.71.71L8 9.41l3.29 3.29c.18.19.43.3.71.3a1.003 1.003 0 00.71-1.71L9.41 8z" fill-rule=evenodd></path></svg></span></button></div></div><div class=bp5-collapse><div class="bp5-collapse-body sf-hidden" aria-hidden=true></div></div></div><div class=body><p>请输入需要翻译的文本。</p></div></div><div class="arrow sf-hidden"></div></div><div id=web-trs-panel></div></div></div></template></div></div><script data-template-shadow-root>(()=>{document.currentScript.remove();processNode(document);function processNode(node){node.querySelectorAll("template[shadowrootmode]").forEach(element=>{let shadowRoot = element.parentElement.shadowRoot;if (!shadowRoot) {try {shadowRoot=element.parentElement.attachShadow({mode:element.getAttribute("shadowrootmode")});shadowRoot.innerHTML=element.innerHTML;element.remove()} catch (error) {} if (shadowRoot) {processNode(shadowRoot)}}})}})()</script>